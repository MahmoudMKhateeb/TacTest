<div [@routerTransition]>
  <div class="content d-flex flex-column flex-column-fluid">
    <!-- [description]="'DriversHeaderInfo' | localize" -->
    <sub-header [title]="'Drivers' | localize">
      <div role="actions">
        <div class="btn-group" dropdown>
          <button
            dropdownToggle
            type="button"
            class="btn btn-outline-success dropdown-toggle mr-1"
            data-toggle="dropdown"
            aria-haspopup="true"
            aria-expanded="false"
          >
            <i class="far fa-file-excel"></i> {{ 'ExcelOperations' | localize }}
          </button>
          <div class="dropdown-menu dropdown-menu-right dropdown-excel-operations" *dropdownMenu>
            <a class="dropdown-item" id="ExportUsersToExcelButton" (click)="exportToExcel()" href="javascript:;">
              <i class="fa fa-download mr-2 mt-1" style="font-size: 1rem;"></i>
              {{ 'ExportToExcel' | localize }}
            </a>
            <a href="javascript:;" *ngIf="'Pages.Administration.Users.Create' | permission" class="no-padding">
              <span class="fileinput-button">
                <p-fileUpload
                  customUpload="true"
                  name="ExcelFileUpload"
                  #ExcelFileUpload
                  maxFileSize="10000000"
                  auto="auto"
                  accept=".csv,.xls,.xlsx"
                  (uploadHandler)="uploadExcel($event)"
                  (onError)="onUploadExcelError()"
                  chooseLabel="{{ 'ImportFromExcel' | localize }}"
                >
                </p-fileUpload>
              </span>
            </a>
            <div class="dropdown-divider"></div>
            <span class="dropdown-item-text text-muted pl-3" href="#">
              <small
                *ngIf="isArabic"
                [innerHTML]="
                  l('ImportToExcelSampleFileDownloadInfo', '<a href=/assets/sampleFiles/ImportDriversSampleFileAr.xlsx>' + l('ClickHere') + '</a>')
                "
              ></small>
              <small
                *ngIf="!isArabic"
                [innerHTML]="
                  l('ImportToExcelSampleFileDownloadInfo', '<a href=/assets/sampleFiles/ImportDriversSampleFile.xlsx>' + l('ClickHere') + '</a>')
                "
              ></small>
            </span>
          </div>
        </div>

        <button (click)="createUser()" *ngIf="'Pages.Administration.Users.Create' | permission" class="btn btn-primary">
          <i class="fa fa-plus"></i> {{ 'CreateNewDriver' | localize }}
        </button>
      </div>
    </sub-header>
    <div [class]="containerClass">
      <div class="card card-custom gutter-b">
        <div class="card-body">
          <form class="form" autocomplete="new-password">
            <div>
              <div class="row align-items-center mb-4">
                <div class="col-xl-12">
                  <div class="form-group m-form__group align-items-center">
                    <div class="input-group">
                      <input
                        [(ngModel)]="filterText"
                        name="filterText"
                        autoFocus
                        class="form-control m-input"
                        [placeholder]="l('SearchWithThreeDot')"
                        type="text"
                      />
                      <span class="input-group-btn">
                        <button (click)="getUsers()" class="btn btn-primary" type="submit">
                          <i class="flaticon-search-1" [attr.aria-label]="l('Search')"></i>
                        </button>
                      </span>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </form>

          <div class="row align-items-center">
            <!--<Primeng-TurboTable-Start>-->
            <div class="primeng-datatable-container" [busyIf]="primengTableHelper.isLoading">
              <p-table
                #dataTable
                sortMode="multiple"
                (onLazyLoad)="getUsers($event)"
                [value]="primengTableHelper.records"
                rows="{{ primengTableHelper.defaultRecordsCountPerPage }}"
                [paginator]="false"
                [lazy]="true"
                [scrollable]="true"
                ScrollWidth="100%"
                [responsive]="primengTableHelper.isResponsive"
                [resizableColumns]="primengTableHelper.resizableColumns"
              >
                <ng-template pTemplate="header">
                  <tr>
                    <th
                      [hidden]="
                        !(
                          [
                            'Pages.Administration.Users.Impersonation',
                            'Pages.Administration.Users.Edit',
                            'Pages.Administration.Users.ChangePermissions',
                            'Pages.Administration.Users.Delete'
                          ] | permissionAny
                        )
                      "
                    >
                      {{ 'Actions' | localize }}
                    </th>
                    <th></th>
                    <th pSortableColumn="username">
                      {{ 'PhoneNumber' | localize }}
                      <p-sortIcon field="username"></p-sortIcon>
                    </th>
                    <th pSortableColumn="emailAddress">
                      {{ 'Email' | localize }}
                      <p-sortIcon field="emailAddress"></p-sortIcon>
                    </th>
                    <th pSortableColumn="AccountNumber">
                      {{ 'AccountNumber' | localize }}
                      <p-sortIcon field="AccountNumber"></p-sortIcon>
                    </th>
                    <th pSortableColumn="name">
                      {{ 'FirstName' | localize }}
                      <p-sortIcon field="name"></p-sortIcon>
                    </th>
                    <th pSortableColumn="surname">
                      {{ 'LastName' | localize }}
                      <p-sortIcon field="surname"></p-sortIcon>
                    </th>
                    <th pSortableColumn="isActive">
                      {{ 'Active' | localize }}
                      <p-sortIcon field="isActive"></p-sortIcon>
                    </th>
                    <th pSortableColumn="creationTime">
                      {{ 'DriverCreationDateAndTime' | localize }}
                      <p-sortIcon field="creationTime"></p-sortIcon>
                    </th>
                  </tr>
                </ng-template>
                <ng-template pTemplate="body" let-record="$implicit">
                  <tr>
                    <td
                      [hidden]="
                        !(
                          [
                            'Pages.Administration.Users.Impersonation',
                            'Pages.Administration.Users.Edit',
                            'Pages.Administration.Users.ChangePermissions',
                            'Pages.Administration.Users.Delete'
                          ] | permissionAny
                        )
                      "
                    >
                      <div class="btn-group dropdown" dropdown container="body">
                        <div class="row ml-1">
                          <button class="dropdown-toggle btn btn-sm btn-primary" dropdownToggle>
                            <i class="fa fa-cog"></i><span class="caret"></span> {{ l('Actions') }}
                          </button>
                        </div>
                        <ul class="dropdown-menu" *dropdownMenu>
                          <li>
                            <a
                              href="javascript:;"
                              class="dropdown-item"
                              (click)="viewOrEditEntityDocumentsModal.show(record.id, documentsEntitiesEnum.Driver)"
                              >{{ l('ViewDocuments') }}</a
                            >
                          </li>
                          <li>
                            <a
                              href="javascript:;"
                              class="dropdown-item"
                              *ngIf="'Pages.Administration.Users.Edit' | permission"
                              (click)="createOrEditUserModal.show(record.id)"
                              >{{ 'Edit' | localize }}</a
                            >
                          </li>
                          <li>
                            <a
                              href="javascript:;"
                              class="dropdown-item"
                              *ngIf="'Pages.Administration.Users.ChangePermissions' | permission"
                              (click)="editUserPermissionsModal.show(record.id, record.userName)"
                              >{{ 'Permissions' | localize }}</a
                            >
                          </li>
                          <li>
                            <a
                              href="javascript:;"
                              class="dropdown-item"
                              *ngIf="'Pages.Administration.Users.Unlock' | permission"
                              (click)="unlockUser(record)"
                              >{{ 'Unlock' | localize }}</a
                            >
                          </li>
                          <li>
                            <a
                              href="javascript:;"
                              class="dropdown-item"
                              *ngIf="'Pages.Administration.Users.Delete' | permission"
                              (click)="deleteUser(record)"
                              >{{ 'Delete' | localize }}</a
                            >
                          </li>
                        </ul>
                      </div>
                    </td>
                    <td>
                      <span
                        *ngIf="record.isMissingDocumentFiles"
                        data-toggle="tooltip"
                        title="Missing documents"
                        class="ml-3 svg-icon svg-icon-warning svg-icon-2x"
                      >
                        <!--begin::Svg Icon | path:/var/www/preview.keenthemes.com/metronic/releases/2020-12-28-020759/theme/html/demo1/dist/../src/media/svg/icons/Code/Warning-1-circle.svg--><svg
                          xmlns="http://www.w3.org/2000/svg"
                          xmlns:xlink="http://www.w3.org/1999/xlink"
                          width="24px"
                          height="24px"
                          viewBox="0 0 24 24"
                          version="1.1"
                        >
                          <g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
                            <rect x="0" y="0" width="24" height="24" />
                            <circle fill="#000000" opacity="0.3" cx="12" cy="12" r="10" />
                            <rect fill="#000000" x="11" y="7" width="2" height="8" rx="1" />
                            <rect fill="#000000" x="11" y="16" width="2" height="2" rx="1" />
                          </g>
                        </svg>
                        <!--end::Svg Icon-->
                      </span>
                    </td>
                    <td>
                      <span class="ui-column-title"> {{ 'UserName' | localize }}</span>
                      <span>
                        {{ record.userName }}
                      </span>
                    </td>
                    <td>
                      <span class="ui-column-title"> {{ 'EmailAddress' | localize }}</span>
                      {{ record.emailAddress }}
                    </td>
                    <td>
                      <span class="ui-column-title"> {{ 'AccountNumber' | localize }}</span>
                      {{ record.accountNumber }}
                    </td>
                    <td>
                      <span class="ui-column-title"> {{ 'Name' | localize }}</span>
                      <span>
                        {{ record.name }}
                      </span>
                    </td>
                    <td>
                      <span class="ui-column-title"> {{ 'Surname' | localize }}</span>
                      <span>
                        {{ record.surname }}
                      </span>
                    </td>
                    <td>
                      <span class="ui-column-title"> {{ 'Active' | localize }}</span>
                      <span class="label label-success label-inline" *ngIf="record.isActive">{{ 'Yes' | localize }}</span>
                      <span class="label label-dark label-inline" *ngIf="!record.isActive">{{ 'No' | localize }}</span>
                    </td>
                    <td>
                      <span class="ui-column-title"> {{ 'CreationTime' | localize }}</span>
                      {{ record.creationTime | momentFormat: 'DD/MM/YY HH:mm' }}
                    </td>
                  </tr>
                </ng-template>
              </p-table>
              <div class="primeng-no-data" *ngIf="primengTableHelper.totalRecordsCount == 0">
                {{ 'NoData' | localize }}
              </div>
              <div class="primeng-paging-container">
                <p-paginator
                  [rows]="primengTableHelper.defaultRecordsCountPerPage"
                  #paginator
                  (onPageChange)="getUsers($event)"
                  [totalRecords]="primengTableHelper.totalRecordsCount"
                  [rowsPerPageOptions]="primengTableHelper.predefinedRecordsCountPerPage"
                >
                </p-paginator>
                <span class="total-records-count">
                  {{ 'TotalRecordsCount' | localize: primengTableHelper.totalRecordsCount }}
                </span>
              </div>
            </div>
            <!--<Primeng-TurboTable-End>-->
          </div>
        </div>
      </div>
    </div>
    <viewOrEditEntityDocumentsModal #viewOrEditEntityDocumentsModal></viewOrEditEntityDocumentsModal>
    <createOrEditDriverModal [creatDriver]="true" #createOrEditUserModal (modalSave)="getUsers()"> </createOrEditDriverModal>
    <editUserPermissionsModal #editUserPermissionsModal></editUserPermissionsModal>
  </div>
</div>
