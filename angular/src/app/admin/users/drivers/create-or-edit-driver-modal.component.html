<div
  appBsModal
  #createOrEditModal="bs-modal"
  (onShown)="onShown()"
  class="modal fade"
  tabindex="-1"
  role="dialog"
  aria-labelledby="createOrEditModal"
  aria-hidden="true"
  [config]="{ backdrop: 'static', keyboard: !saving }"
>
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <form *ngIf="active" #userForm="ngForm" novalidate (ngSubmit)="save()">
        <div class="modal-header">
          <h4 *ngIf="!creatDriver" class="modal-title">
            <span *ngIf="user.id">{{ 'EditUser' | localize }}: {{ user.userName }}</span>
            <span *ngIf="!user.id">{{ 'CreateNewUser' | localize }}</span>
          </h4>
          <h4 *ngIf="creatDriver" class="modal-title">
            <span *ngIf="user.id">{{ 'Edit Driver' | localize }}: {{ user.userName }}</span>
            <span *ngIf="!user.id">{{ 'Create New Driver' | localize }}</span>
          </h4>
          <button type="button" class="close" (click)="close()" [attr.aria-label]="l('Close')" [disabled]="saving">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <tabset>
            <tab class="pt-5" heading="{{ 'UserInformations' | localize }}">
              <div class="row">
                <div class="col-sm-3 text-center mb-5 mt-5">
                  <img src="{{ profilePicture }}" width="128" height="128" class="img-thumbnail img-rounded" />
                </div>
                <div class="col-sm-9">
                  <div class="form-group">
                    <label for="UserName">{{ 'PhoneNumber' | localize }} *</label>
                    <div [class]="isWaintingUserNameValidation ? 'spinner spinner-primary spinner-left' : ''">
                      <input
                        (focusout)="CheckIfDriverUserNameIsValid(userNameInput.value)"
                        id="UserName"
                        #userNameInput="ngModel"
                        type="number"
                        [disabled]="!canChangeUserName"
                        name="UserName"
                        [class]="
                          !userNameInput.touched || isWaintingUserNameValidation
                            ? 'form-control'
                            : isUserNameValid
                            ? 'form-control is-valid'
                            : 'form-control is-invalid'
                        "
                        [(ngModel)]="user.userName"
                        required
                        maxlength="256"
                      />
                    </div>
                    <div *ngIf="isUserNameValid" class="valid-feedback">Success! You've done it.</div>

                    <span class="help-block" *ngIf="!canChangeUserName">{{ 'CanNotChangeAdminUserName' | localize }}</span>
                    <validation-messages [formCtrl]="userNameInput"></validation-messages>
                  </div>
                  <div class="row">
                    <div class="col-6">
                      <div class="form-group">
                        <label for="Name">{{ 'Name' | localize }} *</label>
                        <input
                          id="Name"
                          #nameInput="ngModel"
                          class="form-control"
                          type="text"
                          name="Name"
                          [(ngModel)]="user.name"
                          required
                          maxlength="64"
                        />
                        <validation-messages [formCtrl]="nameInput"></validation-messages>
                      </div>
                    </div>
                    <div class="col-6">
                      <div class="form-group">
                        <label for="Surname">{{ 'Surname' | localize }} *</label>
                        <input
                          id="Surname"
                          #surnameInput="ngModel"
                          type="text"
                          name="Surname"
                          class="form-control"
                          [(ngModel)]="user.surname"
                          required
                          maxlength="64"
                        />
                        <validation-messages [formCtrl]="surnameInput"></validation-messages>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <div class="form-group">
                <label for="EmailAddress">{{ 'EmailAddress' | localize }} *</label>
                <input
                  id="EmailAddress"
                  #emailAddressInput="ngModel"
                  type="email"
                  name="EmailAddress"
                  class="form-control"
                  [(ngModel)]="user.emailAddress"
                  required
                  maxlength="256"
                  email
                />
                <validation-messages [formCtrl]="emailAddressInput"></validation-messages>
              </div>

              <!--              <div class="form-group">-->
              <!--                <label for="PhoneNumber">{{ 'PhoneNumber' | localize }}</label>-->
              <!--                <input id="PhoneNumber" type="text" name="PhoneNumber" class="form-control" [(ngModel)]="user.phoneNumber" maxlength="32" />-->
              <!--              </div>-->
              <div class="form-group">
                <label for="Nationality">{{ 'Nationality' | localize }}</label>
                <!-- <select [(ngModel)]="user.nationality" class="form-control form-control-lg custom-select mr-sm-2" style="color: red;">
                  <option *ngFor="let nationality of nationalities" [value]="nationality.id">{{ nationality.name }}</option>
                </select> -->
                <input id="Nationality" type="text" name="Nationality" class="form-control" [(ngModel)]="user.nationality" maxlength="64" />
              </div>

              <div class="row">
                <div class="col-6">
                  <div class="form-group">
                    <label for="Address">{{ 'Address' | localize }}</label>
                    <input id="Address" type="text" name="Address" class="form-control" [(ngModel)]="user.address" maxlength="256" />
                  </div>
                </div>
                <div class="col-6">
                  <div class="form-group" *ngIf="user.isDriver">
                    <label for="ExperienceField">{{ 'ExperienceField' | localize }}</label>
                    <input
                      id="ExperienceField"
                      type="text"
                      name="DrivingLicenseNumber"
                      class="form-control"
                      [(ngModel)]="user.experienceField"
                      maxlength="256"
                    />
                  </div>
                </div>
              </div>

              <!--              <div class="checkbox-inline">-->
              <!--                <label for="EditUser_SetRandomPassword" class="checkbox">-->
              <!--                  <input id="EditUser_SetRandomPassword" type="checkbox" name="SetRandomPassword" [(ngModel)]="setRandomPassword" />-->
              <!--                  {{ 'SetRandomPassword' | localize }}-->
              <!--                  <span></span>-->
              <!--                </label>-->
              <!--              </div>-->
              <!--              <div class="form-group" *ngIf="!setRandomPassword">-->
              <!--                <div class="right">-->
              <!--                  <label for="Password">{{ 'Password' | localize }}</label>-->
              <!--                  <input-->
              <!--                    id="Password"-->
              <!--                    type="password"-->
              <!--                    name="Password"-->
              <!--                    #Password="ngModel"-->
              <!--                    id="Password"-->
              <!--                    class="form-control"-->
              <!--                    [(ngModel)]="user.password"-->
              <!--                    [required]="!user.id && !setRandomPassword"-->
              <!--                    maxlength="32"-->
              <!--                    [requireDigit]="passwordComplexitySetting.requireDigit"-->
              <!--                    [requireLowercase]="passwordComplexitySetting.requireLowercase"-->
              <!--                    [requireUppercase]="passwordComplexitySetting.requireUppercase"-->
              <!--                    [requireNonAlphanumeric]="passwordComplexitySetting.requireNonAlphanumeric"-->
              <!--                    [requiredLength]="passwordComplexitySetting.requiredLength"-->
              <!--                    validateEqual="PasswordRepeat"-->
              <!--                    reverse="true"-->
              <!--                    autocomplete="new-password"-->
              <!--                  />-->
              <!--                </div>-->
              <!--              </div>-->
              <!--              <div [hidden]="setRandomPassword || userForm.form.valid || userForm.form.pristine">-->
              <!--                <ul class="help-block text-danger" *ngIf="userForm.controls['Password'] && userForm.controls['Password'].errors">-->
              <!--                  <li [hidden]="!userForm.controls['Password'].errors.requireDigit">-->
              <!--                    {{ 'PasswordComplexity_RequireDigit_Hint' | localize }}-->
              <!--                  </li>-->
              <!--                  <li [hidden]="!userForm.controls['Password'].errors.requireLowercase">-->
              <!--                    {{ 'PasswordComplexity_RequireLowercase_Hint' | localize }}-->
              <!--                  </li>-->
              <!--                  <li [hidden]="!userForm.controls['Password'].errors.requireUppercase">-->
              <!--                    {{ 'PasswordComplexity_RequireUppercase_Hint' | localize }}-->
              <!--                  </li>-->
              <!--                  <li [hidden]="!userForm.controls['Password'].errors.requireNonAlphanumeric">-->
              <!--                    {{ 'PasswordComplexity_RequireNonAlphanumeric_Hint' | localize }}-->
              <!--                  </li>-->
              <!--                  <li [hidden]="!userForm.controls['Password'].errors.requiredLength">-->
              <!--                    {{ 'PasswordComplexity_RequiredLength_Hint' | localize: passwordComplexitySetting.requiredLength }}-->
              <!--                  </li>-->
              <!--                </ul>-->
              <!--              </div>-->
              <!--              <div class="form-group" *ngIf="!setRandomPassword">-->
              <!--                <div class="right">-->
              <!--                  <label for="PasswordRepeat">{{ 'PasswordRepeat' | localize }}</label>-->
              <!--                  <input-->
              <!--                    id="PasswordRepeat"-->
              <!--                    type="password"-->
              <!--                    name="PasswordRepeat"-->
              <!--                    #PasswordRepeat="ngModel"-->
              <!--                    class="form-control"-->
              <!--                    [(ngModel)]="userPasswordRepeat"-->
              <!--                    [required]="!user.id && !setRandomPassword"-->
              <!--                    maxlength="32"-->
              <!--                    [requireDigit]="passwordComplexitySetting.requireDigit"-->
              <!--                    [requireLowercase]="passwordComplexitySetting.requireLowercase"-->
              <!--                    [requireUppercase]="passwordComplexitySetting.requireUppercase"-->
              <!--                    [requireNonAlphanumeric]="passwordComplexitySetting.requireNonAlphanumeric"-->
              <!--                    [requiredLength]="passwordComplexitySetting.requiredLength"-->
              <!--                    validateEqual="Password"-->
              <!--                    reverse="false"-->
              <!--                    autocomplete="new-password"-->
              <!--                  />-->
              <!--                </div>-->
              <!--              </div>-->
              <!--              <div [hidden]="setRandomPassword || userForm.form.valid || userForm.form.pristine">-->
              <!--                <ul class="help-block text-danger" *ngIf="userForm.controls['PasswordRepeat'] && userForm.controls['PasswordRepeat'].errors">-->
              <!--                  <li [hidden]="!userForm.controls['PasswordRepeat'].errors.requireDigit">-->
              <!--                    {{ 'PasswordComplexity_RequireDigit_Hint' | localize }}-->
              <!--                  </li>-->
              <!--                  <li [hidden]="!userForm.controls['PasswordRepeat'].errors.requireLowercase">-->
              <!--                    {{ 'PasswordComplexity_RequireLowercase_Hint' | localize }}-->
              <!--                  </li>-->
              <!--                  <li [hidden]="!userForm.controls['PasswordRepeat'].errors.requireUppercase">-->
              <!--                    {{ 'PasswordComplexity_RequireUppercase_Hint' | localize }}-->
              <!--                  </li>-->
              <!--                  <li [hidden]="!userForm.controls['PasswordRepeat'].errors.requireNonAlphanumeric">-->
              <!--                    {{ 'PasswordComplexity_RequireNonAlphanumeric_Hint' | localize }}-->
              <!--                  </li>-->
              <!--                  <li [hidden]="!userForm.controls['PasswordRepeat'].errors.requiredLength">-->
              <!--                    {{ 'PasswordComplexity_RequiredLength_Hint' | localize: passwordComplexitySetting.requiredLength }}-->
              <!--                  </li>-->
              <!--                  <li [hidden]="userForm.controls['PasswordRepeat'].valid">{{ 'PasswordsDontMatch' | localize }}</li>-->
              <!--                </ul>-->
              <!--              </div>-->
              <div class="checkbox-inline">
                <label for="EditUser_ShouldChangePasswordOnNextLogin" class="checkbox">
                  <input
                    id="EditUser_ShouldChangePasswordOnNextLogin"
                    type="checkbox"
                    name="ShouldChangePasswordOnNextLogin"
                    [(ngModel)]="user.shouldChangePasswordOnNextLogin"
                  />
                  {{ 'ShouldChangePasswordOnNextLogin' | localize }}
                  <span></span>
                </label>
                <label for="EditUser_IsActive" class="checkbox">
                  <input id="EditUser_IsActive" type="checkbox" name="IsActive" [(ngModel)]="user.isActive" />
                  {{ 'Active' | localize }}
                  <span></span>
                </label>

                <label *ngIf="isTwoFactorEnabled" for="EditUser_IsTwoFactorEnabled" class="checkbox">
                  <input id="EditUser_IsTwoFactorEnabled" type="checkbox" name="IsTwoFactorEnabled" [(ngModel)]="user.isTwoFactorEnabled" />
                  {{ 'IsTwoFactorEnabled' | localize }}
                  <span></span>
                </label>

                <label *ngIf="isLockoutEnabled" for="EditUser_IsLockoutEnabled" class="checkbox">
                  <input id="EditUser_IsLockoutEnabled" type="checkbox" name="IsLockoutEnabled" [(ngModel)]="user.isLockoutEnabled" />
                  {{ 'IsLockoutEnabled' | localize }}
                  <span></span>
                </label>
              </div>
            </tab>
            <tab *ngIf="!user.id" class="pt-5" heading="{{ 'DriverDocuments' | localize }}">
              <div *ngFor="let item of createOrEditDocumentFileDtos; index as i" class="">
                <div class="card card-custom">
                  <div class="card-header">
                    <div class="card-title">
                      <h3 class="card-title">{{ item.documentTypeDto.displayName }}</h3>
                    </div>
                  </div>
                  <div class="card-body">
                    <div class="row d-flex">
                      <div class="form-group col-6">
                        <label>{{ l('File') }}</label>
                        <div class="custom-file">
                          <input
                            (change)="DocFileChangeEvent($event, item)"
                            type="file"
                            class="custom-file-input"
                            [required]="item.documentTypeDto.isRequired"
                          />
                          <label class="custom-file-label text-truncate" [for]="item.documentTypeDto.displayName">
                            {{ item.name ? item.name : l('select file') }}</label
                          >
                        </div>
                      </div>
                      <div *ngIf="item.documentTypeDto.hasExpirationDate" class="form-group col-6">
                        <label>{{ l('expiration date') }} <span class="text-danger">*</span></label>
                        <input
                          name="expirationDate{{ i }}"
                          id="expirationDate{{ i }}"
                          bsDatepicker
                          class="form-control m-input"
                          datePickerMomentModifier
                          [required]="item.documentTypeDto.isRequired"
                          [(date)]="item.expirationDate"
                        />
                      </div>
                      <div *ngIf="item.documentTypeDto.hasNumber" class="form-group col-6">
                        <label
                          >{{ l('number') }}
                          <span class="text-danger">*</span>
                        </label>
                        <input
                          name="number{{ i }}"
                          id="number{{ i }}"
                          class="form-control m-input"
                          required
                          [maxLength]="item.documentTypeDto.numberMaxDigits == 0 ? 50 : item.documentTypeDto.numberMaxDigits"
                          [minLength]="item.documentTypeDto.numberMinDigits"
                          type="text"
                          [(ngModel)]="item.number"
                        />
                        <span class="form-text text-muted"
                          >{{ l('minDigits:') }} {{ item.documentTypeDto.numberMinDigits }} {{ l('maxDigits:') }}
                          {{ item.documentTypeDto.numberMaxDigits == 0 ? 50 : item.documentTypeDto.numberMaxDigits }}
                        </span>
                      </div>
                      <div *ngIf="item.documentTypeDto.hasNotes" class="form-group col-6">
                        <label>{{ l('note') }}</label>
                        <input
                          name="note{{ i }}"
                          id="note{{ i }}"
                          class="form-control m-input"
                          [required]="item.documentTypeDto.hasNotes"
                          type="text"
                          [(ngModel)]="item.notes"
                        />
                      </div>

                      <div *ngIf="item.documentTypeDto.hasExpirationDate" class="form-group col-6">
                        <hijri-gregorian-datepicker-test
                          [label]="l('ExpirationDate')"
                          class="m-input"
                          [isRequired]="true"
                          [readonly]="true"
                          [selectedDateType]="item.documentTypeDto.hasHijriExpirationDate ? selectedDateTypeHijri : selectedDateTypeGregorian"
                          (selectedDateChange)="selectedDateChange($event, item)"
                        >
                        </hijri-gregorian-datepicker-test>
                      </div>
                    </div>
                  </div>

                  <div *ngIf="createOrEditDocumentFileDtos.length - 1 != i" class="separator separator-dashed my-5"></div>
                </div>
              </div>
            </tab>
          </tabset>
        </div>
        <div class="modal-footer">
          <button [disabled]="saving" type="button" class="btn btn-light-primary font-weight-bold" (click)="close()">
            {{ 'Cancel' | localize }}
          </button>
          <button
            type="submit"
            class="btn btn-save font-weight-bold"
            [disabled]="!userForm.form.valid"
            [buttonBusy]="saving"
            [busyText]="l('SavingWithThreeDot')"
          >
            <i class="fa fa-save"></i> <span>{{ 'Save' | localize }}</span>
          </button>
        </div>
      </form>
    </div>
  </div>
</div>
