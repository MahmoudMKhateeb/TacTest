<!--suppress XmlInvalidId -->
<div [@routerTransition]>
  <div class="content d-flex flex-column flex-column-fluid">
    <sub-header
      [breadcrumbs]="breadcrumbs"
      [title]="shippingRequest.id ? ('ShippingRequestsEdit' | localize) : ('ShippingRequestsCreate' | localize)"
    ></sub-header>

    <div [class]="containerClass">
      <form *ngIf="active" #shippingRequestForm="ngForm" autocomplete="off">
        <div class="card card-custom gutter-b">
          <!--  start of card::form-->
          <div class="card-header">
            <h3 class="card-title">{{ l('truckDetails') }}</h3>
          </div>
          <!--  start of card::body-->
          <div class="card-body">
            <div class="row">
              <!--  start of truck::Details-->
              <div class="col-12">
                <div class="mb-3">
                  <div class="mb-2">
                    <div class="form-group row fv-plugins-icon-container">
                      <div class="col-lg-6">
                        <label>* {{ l('transportType') }}:</label>
                        <div [ngClass]="{ 'spinner spinner-success spinner-right mr-1 ml-1': !allTransportTypes }">
                          <select
                            class="form-control"
                            name="transportType"
                            #TransportType="ngModel"
                            required
                            [disabled]="!allTransportTypes"
                            [(ngModel)]="shippingRequest.transportTypeId"
                            [class.is-invalid]="allTransportTypes && TransportType.touched && !TransportType.valid"
                            [class.is-valid]="allTransportTypes && TransportType.touched && TransportType.valid"
                            (change)="transportTypeSelectChange(shippingRequest.transportTypeId)"
                          >
                            <option [ngValue]="null">{{ l('selectaTransportType') }}</option>
                            <option *ngFor="let item of allTransportTypes" value="{{ item.id }}">{{ item.displayName }}</option>
                          </select>
                        </div>
                        <span class="form-text text-muted">{{ l('selectaTransportType') }}</span>
                      </div>
                      <div class="col-lg-6 mb-3">
                        <label>* {{ l('truckType') }}:</label>
                        <div>
                          <div
                            [ngClass]="{
                              'spinner spinner-success spinner-right mr-1 ml-1': truckTypeLoading
                            }"
                          >
                            <select
                              #TruckType="ngModel"
                              class="form-control"
                              name="truckType"
                              required
                              [disabled]="shippingRequest.transportTypeId == null || allTransportTypes == null || allTrucksTypes == null"
                              [(ngModel)]="shippingRequest.trucksTypeId"
                              [class.is-invalid]="allTrucksTypes && TruckType.touched && !TruckType.valid"
                              [class.is-valid]="allTrucksTypes && TruckType.touched && TruckType.valid"
                              (change)="trucksTypeSelectChange(shippingRequest.trucksTypeId)"
                            >
                              <option [ngValue]="null">{{ l('selectaTruckType') }}</option>
                              <option *ngFor="let item of allTrucksTypes" value="{{ item.id }}">{{ item.displayName }}</option>
                            </select>
                          </div>
                        </div>

                        <span class="form-text text-muted">{{ l('selectaTruckType') }}</span>
                      </div>
                      <div class="col-lg-6">
                        <label>* {{ l('Capacity') }}:</label>
                        <div
                          [ngClass]="{
                            'spinner spinner-success spinner-right mr-1 ml-1': capacityLoading
                          }"
                        >
                          <select
                            #Capacity="ngModel"
                            class="form-control"
                            name="capacity"
                            required
                            [disabled]="
                              capacityLoading ||
                              shippingRequest.trucksTypeId == null ||
                              shippingRequest.transportTypeId == null ||
                              allTransportTypes == null ||
                              allTrucksTypes == null
                            "
                            [(ngModel)]="shippingRequest.capacityId"
                            [class.is-invalid]="allCapacities && Capacity.touched && !Capacity.valid"
                            [class.is-valid]="allCapacities && Capacity.touched && Capacity.valid"
                          >
                            <option [ngValue]="null">{{ l('selectaCapacity') }}</option>
                            <option *ngFor="let item of allCapacities" value="{{ item.id }}">{{ item.displayName }}</option>
                          </select>
                        </div>
                        <span class="form-text text-muted">{{ l('selectaCapacity') }}</span>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <!--  end of truck::Details-->
            </div>
          </div>
          <!--  end of card::body-->
          <!--  start of card::form-->
        </div>
        <div class="card card-custom gutter-b">
          <!--  start of card::form-->
          <div class="card-header">
            <h3 class="card-title">{{ l('ShippingRequestProperties') }}</h3>
          </div>
          <!--  start of card::body-->
          <div class="card-body">
            <div class="row">
              <!--  start of ShippingRequestType::Details-->
              <div class="col-12">
                <div class="mb-3">
                  <div class="mb-2">
                    <div class="form-group row fv-plugins-icon-container">
                      <div class="col-lg-6">
                        <label>* {{ l('ShippingRequestType') }}:</label>
                        <select
                          #SRType="ngModel"
                          class="form-control"
                          name="shippingRequestType"
                          required
                          [class.is-invalid]="SRType.touched && !SRType.valid"
                          [class.is-valid]="SRType.touched && SRType.valid"
                          [(ngModel)]="shippingRequestType"
                          (change)="resetBiddingDates()"
                          [disabled]="shippingRequest.id"
                        >
                          <option value="">Select</option>
                          <option value="bidding">{{ l('bidding') }}</option>
                          <option value="tachyondeal">{{ l('TachyonDeal') }}</option>
                        </select>
                        <span class="form-text text-muted">{{ l('pickaShippingRequestType') }}</span>
                      </div>
                      <div class="col-lg-3">
                        <div class="form-group">
                          <label>* {{ l('biddingStartDate') }}:</label>
                          <div class="input-group date">
                            <input
                              class="form-control"
                              placeholder="{{ l('BiddingstartDate') }}"
                              name="shippingrequestBidStratDate"
                              [required]="this.shippingRequestType == 'bidding'"
                              [(date)]="shippingRequest.bidStartDate"
                              [disabled]="shippingRequestType != 'bidding' || shippingRequest.id"
                              [minDate]="today"
                              bsDatepicker
                              datePickerMomentModifier
                            />
                            <div class="input-group-append">
                              <span class="input-group-text">
                                <i class="la la-calendar-check-o"></i>
                              </span>
                            </div>
                          </div>
                          <span class="form-text text-muted">{{ l('SetBiddingStartDate') }} (in case of shipping request type is bidding)</span>
                        </div>
                      </div>
                      <div class="col-lg-3">
                        <label>* {{ l('biddingEndDate') }}:</label>
                        <div class="input-group date">
                          <input
                            class="form-control"
                            placeholder="{{ l('biddingEndDate') }}"
                            name="shippingrequestBidEndDate"
                            [required]="this.shippingRequestType == 'bidding'"
                            [(date)]="shippingRequest.bidEndDate"
                            [disabled]="shippingRequestType != 'bidding'"
                            [minDate]="today"
                            bsDatepicker
                            datePickerMomentModifier
                          />
                          <div class="input-group-append">
                            <span class="input-group-text">
                              <i class="la la-calendar-check-o"></i>
                            </span>
                          </div>
                        </div>
                        <span class="form-text text-muted">{{ l('biddingEndDate') }} (in case of shipping request type is bidding)</span>
                      </div>
                      <!--       Start Of Shipping Type                 -->
                      <div class="col-lg-6">
                        <label>* {{ l('shippingType') }}:</label>
                        <div
                          [ngClass]="{
                            'spinner spinner-success spinner-right mr-1 ml-1': !allShippingTypes
                          }"
                        >
                          <select
                            #shippingType="ngModel"
                            class="form-control"
                            name="shippingType"
                            required
                            [(ngModel)]="shippingRequest.shippingTypeId"
                            [class.is-invalid]="shippingType.touched && !shippingType.valid"
                            [class.is-valid]="shippingType.touched && shippingType.valid"
                            [disabled]="!allShippingTypes"
                          >
                            <option [ngValue]="null">{{ l('selectAshippingType') }}</option>
                            <option *ngFor="let item of allShippingTypes" value="{{ item.id }}">{{ item.displayName }}</option>
                          </select>
                        </div>
                        <span class="form-text text-muted">{{ l('selectAShippingType') }}</span>
                      </div>
                      <!--                        End of Shipping Type-->
                    </div>
                  </div>
                </div>
              </div>
              <!--  end of ShippingRequestType::Details-->
            </div>
          </div>
          <!--  end of card::body-->

          <!--  start of card::form-->
        </div>
        <div class="card card-custom gutter-b">
          <!--  start of card::form-->
          <div class="card-header">
            <h3 class="card-title">{{ l('GoodDetails') }}</h3>
          </div>
          <!--  start of card::body-->
          <div class="card-body">
            <div class="row">
              <!--  start of Shipment::Details-->
              <div class="col-12">
                <div class="mb-3">
                  <div class="mb-2">
                    <div class="row">
                      <div class="col-lg-6">
                        <label>* {{ l('MainGoodCategory') }}:</label>
                        <div [ngClass]="{ 'spinner spinner-success spinner-right mr-1 ml-1': !allGoodCategorys }">
                          <select
                            #goodCategory="ngModel"
                            class="form-control"
                            name="goodCategory"
                            [disabled]="!allGoodCategorys"
                            [(ngModel)]="shippingRequest.goodCategoryId"
                            required
                            [class.is-invalid]="goodCategory.touched && !goodCategory.valid"
                            [class.is-valid]="goodCategory.touched && goodCategory.valid"
                          >
                            <option [ngValue]="undefined">{{ l('SelectAGoodCategory') }}</option>
                            <option *ngFor="let item of allGoodCategorys" value="{{ item.id }}">{{ item.displayName }}</option>
                          </select>
                        </div>

                        <span class="form-text text-muted">{{ l('selectaGoodCategory') }}</span>
                      </div>
                      <div class="col-lg-6">
                        <label>* {{ l('totalWeight') }}:</label>
                        <div>
                          <div class="input-group">
                            <div class="input-group-append">
                              <span class="input-group-text">
                                KG
                              </span>
                            </div>
                            <input
                              #Weight="ngModel"
                              type="number"
                              name="Weight"
                              class="form-control"
                              placeholder="Weight"
                              [(ngModel)]="shippingRequest.totalWeight"
                              (keypress)="numberOnly($event)"
                              required
                              [class.is-invalid]="Weight.touched && !Weight.valid"
                              [class.is-valid]="Weight.touched && Weight.valid"
                            />
                          </div>
                        </div>
                        <span class="form-text text-muted">{{ l('totalWeightofGoodsinKG') }}</span>
                      </div>

                      <div class="col-lg-6 mt-4">
                        <div class="form-group">
                          <div
                            [ngClass]="{
                              'spinner spinner-success spinner-right mr-1 ml-1': !allpackingTypes
                            }"
                          >
                            <label>* {{ l('packingType') }}:</label>
                            <select
                              #packingType="ngModel"
                              class="form-control"
                              name="packingType"
                              required
                              [(ngModel)]="shippingRequest.packingTypeId"
                              [class.is-invalid]="packingType.touched && !packingType.valid"
                              [class.is-valid]="packingType.touched && packingType.valid"
                              [disabled]="!allpackingTypes"
                            >
                              <option [ngValue]="null">{{ l('selectaPackingType') }}</option>
                              <option *ngFor="let item of allpackingTypes" value="{{ item.id }}">{{ item.displayName }}</option>
                            </select>
                          </div>
                          <span class="form-text text-muted">{{ l('enterPackingType') }}</span>
                        </div>
                      </div>
                      <div class="col-lg-6 mt-4">
                        <div class="form-group">
                          <label>* {{ l('numberOfPacking') }}:</label>
                          <input
                            #numberOfPacking="ngModel"
                            class="form-control"
                            type="number"
                            name="numberOfPacking"
                            id="numberOfPacking"
                            [(ngModel)]="shippingRequest.numberOfPacking"
                            required
                            [class.is-invalid]="numberOfPacking.touched && !numberOfPacking.valid"
                            [class.is-valid]="numberOfPacking.touched && numberOfPacking.valid"
                          />
                          <span class="form-text text-muted">{{ l('enterNumberOfPacking') }}</span>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <!--  end of Shipment::Details-->
              <!--  Start:Goods details  -->
              <!--                (SelectedGoodDetailsFromChild)="shippingRequest.goodsDetailS = $event"-->
              <!--              <GoodDetailsForCreateShippingRequest [MainCategory]="shippingRequest.goodCategoryId"></GoodDetailsForCreateShippingRequest>-->
              <!--   end::Goods details   -->
            </div>
          </div>
          <!--  end of card::body-->

          <!--  start of card::form-->
        </div>
        <div class="card card-custom gutter-b">
          <!--  start of card::form-->
          <div class="card-header">
            <h3 class="card-title">{{ l('routeDetails') }}</h3>
          </div>
          <!--  start of card::body-->
          <div class="card-body">
            <div class="row">
              <!--  start of Route::Details-->
              <div class="col-12">
                <div class="mb-3">
                  <div class="mb-2">
                    <div class="row">
                      <!-- Start of Select Source -->
                      <div class="col-lg-3">
                        <div class="form-group">
                          <label>* {{ l('originCity') }}:</label>
                          <div [ngClass]="{ 'spinner spinner-success spinner-right mr-1 ml-1': !allCitys }">
                            <select
                              #Origin="ngModel"
                              class="form-control"
                              name="origin"
                              [disabled]="!allCitys"
                              [(ngModel)]="shippingRequest.createOrEditRouteDto.originCityId"
                              required
                              [class.is-invalid]="Origin.touched && !Origin.valid"
                              [class.is-valid]="Origin.touched && Origin.valid"
                            >
                              <option value="">{{ l('selectanOriginCity') }}</option>
                              <option *ngFor="let item of allCitys" value="{{ item.id }}">{{ item.displayName }}</option>
                            </select>
                          </div>

                          <span class="form-text text-muted">{{ l('selectaCity') }}</span>
                        </div>
                      </div>
                      <div class="col-lg-3">
                        <div class="form-group">
                          <label>* {{ l('destinationCity') }}:</label>
                          <div [ngClass]="{ 'spinner spinner-success spinner-right mr-1 ml-1': !allCitys }">
                            <select
                              #Destination="ngModel"
                              class="form-control"
                              name="destination"
                              required
                              [class.is-invalid]="Destination.touched && !Destination.valid"
                              [class.is-valid]="Destination.touched && Destination.valid"
                              [disabled]="!allCitys"
                              [(ngModel)]="shippingRequest.createOrEditRouteDto.destinationCityId"
                            >
                              <option value="">{{ l('selectaDestination') }}</option>
                              <option *ngFor="let item of allCitys" value="{{ item.id }}">{{ item.displayName }}</option>
                            </select>
                          </div>
                          <span class="form-text text-muted">{{ l('selectaCity') }}</span>
                        </div>
                      </div>
                      <div class="col-lg-3">
                        <div class="form-group">
                          <label>{{ l('originFacility') }}:</label>
                          <div [ngClass]="{ 'spinner spinner-success spinner-right mr-1 ml-1': !allFacilities }">
                            <select
                              class="form-control"
                              name="originFacility"
                              [(ngModel)]="shippingRequest.createOrEditRouteDto.originFacilityId"
                              [disabled]="!allFacilities"
                            >
                              <option value="">{{ l('selectanOriginFacility') }}</option>
                              <option *ngFor="let item of allFacilities" value="{{ item.id }}">{{ item.displayName }}</option>
                            </select>
                          </div>

                          <span class="form-text text-muted">{{ l('optional') }}</span>
                        </div>
                      </div>
                      <div class="col-lg-3">
                        <div class="form-group">
                          <label>{{ l('destinationFacility') }}:</label>
                          <div [ngClass]="{ 'spinner spinner-success spinner-right mr-1 ml-1': !allFacilities }">
                            <select
                              class="form-control"
                              name="destinationFacility"
                              [(ngModel)]="shippingRequest.createOrEditRouteDto.destinationFacilityId"
                              [disabled]="!allFacilities"
                            >
                              <option value=""></option>
                              <option *ngFor="let item of allFacilities" value="{{ item.id }}">{{ item.displayName }}</option>
                            </select>
                          </div>
                          <span class="form-text text-muted">{{ l('optional') }}</span>
                        </div>
                      </div>
                      <div class="col-lg-6">
                        <div class="form-group">
                          <label>* {{ l('startDate') }}:</label>
                          <div class="input-group date">
                            <input
                              [(date)]="shippingRequest.startTripDate"
                              class="form-control"
                              type="datetime"
                              name="startdate"
                              placeholder="Startdate"
                              [minDate]="today"
                              bsDatepicker
                              datePickerMomentModifier
                            />

                            <div class="input-group-append">
                              <span class="input-group-text">
                                <i class="la la-calendar-check-o"></i>
                              </span>
                            </div>
                          </div>
                          <span class="form-text text-muted">{{ l('pickaStartDate') }}</span>
                        </div>
                      </div>
                      <div class="col-lg-6">
                        <div class="form-group">
                          <label>* {{ l('endDate') }}:</label>
                          <div class="input-group date">
                            <input
                              [(date)]="shippingRequest.endTripDate"
                              class="form-control"
                              name="endDate"
                              placeholder="{{ l('endDate') }}"
                              [minDate]="today"
                              bsDatepicker
                              datePickerMomentModifier
                            />
                            <div class="input-group-append">
                              <span class="input-group-text">
                                <i class="la la-calendar-check-o"></i>
                              </span>
                            </div>
                          </div>
                          <span class="form-text text-muted">{{ l('pickanEndDate') }}</span>
                        </div>
                      </div>
                      <div class="col-lg-3">
                        <label>* {{ l('routeType') }}:</label>
                        <div [ngClass]="{ 'spinner spinner-success spinner-right mr-1 ml-1': !allRoutTypes }">
                          <select
                            #RouteType="ngModel"
                            class="form-control"
                            name="routeType"
                            required
                            [disabled]="!allRoutTypes"
                            [(ngModel)]="selectedRouteType"
                            [class.is-invalid]="RouteType.touched && !RouteType.valid"
                            [class.is-valid]="RouteType.touched && RouteType.valid"
                            (change)="shippingRequest.numberOfDrops = undefined"
                          >
                            <option value="">{{ l('SelectRouteType') }}</option>
                            <option *ngFor="let item of allRoutTypes" value="{{ item.id }}">{{ item.displayName }}</option>
                          </select>
                        </div>
                        <span class="form-text text-muted">{{ l('pickaRouteType') }}</span>
                      </div>
                      <div class="col-lg-3">
                        <div class="form-group">
                          <label>* {{ l('numberOfDrops') }}:</label>
                          <input
                            #NumberOfDrops="ngModel"
                            class="form-control"
                            type="number"
                            name="numberOfDrops"
                            id="numberOfDrops"
                            maxlength="2"
                            [required]="selectedRouteType == 3"
                            [(ngModel)]="shippingRequest.numberOfDrops"
                            [class.is-invalid]="selectedRouteType == 3 && NumberOfDrops.touched && !NumberOfDrops.valid"
                            [class.is-valid]="selectedRouteType == 3 && NumberOfDrops.touched && NumberOfDrops.valid"
                            [disabled]="selectedRouteType != 3"
                          />
                          <span class="form-text text-muted">{{ l('numberOfDrops') }} {{ l('forMiltibleTripsRouteType') }}</span>
                        </div>
                      </div>
                      <div class="col-lg-6">
                        <div class="form-group">
                          <label>* {{ l('numberOfTrips') }}:</label>
                          <input
                            #numberOfTrips="ngModel"
                            class="form-control"
                            type="number"
                            name="numberOfTrips"
                            id="numberOfTrips"
                            [(ngModel)]="shippingRequest.numberOfTrips"
                            required
                            maxlength="2"
                            [class.is-invalid]="numberOfTrips.touched && !numberOfTrips.valid"
                            [class.is-valid]="numberOfTrips.touched && numberOfTrips.valid"
                          />
                          <span class="form-text text-muted">{{ l('enterNumberOfTrips') }}</span>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <!--  Start::RouteSteps     -->
              <RouteStepsForCreateShippingRequest
                [MainGoodsCategory]="shippingRequest.goodCategoryId"
                [RouteType]="shippingRequest.createOrEditRouteDto.routTypeId || this.selectedRouteType"
                [NumberOfDrops]="shippingRequest.numberOfDrops"
                (SelectedWayPointsFromChild)="shippingRequest.createOrEditRoutPointDtoList = $event"
                [WayPointListFromFatherForShippingRequestEdit]="shippingRequest.createOrEditRoutPointDtoList"
              ></RouteStepsForCreateShippingRequest>
              <!--   End::RouteSteps      -->
              <!--  end of Route::Details-->
            </div>
          </div>
          <!--  end of card::body-->
          <!--  start of card::form-->
        </div>
        <div class="card card-custom gutter-b">
          <!--  start of card::form-->
          <div class="card-header">
            <h3 class="card-title">{{ l('vasDetails') }}</h3>
          </div>
          <!--  start of card::body-->
          <div class="card-body">
            <!--  start of Vas::Details-->
            <div class="row">
              <div class="col-3">
                <p-listbox
                  name="VasList"
                  [options]="allVases"
                  [metaKeySelection]="false"
                  [checkbox]="true"
                  [filter]="true"
                  [multiple]="true"
                  optionLabel="vasName"
                  [listStyle]="{ 'max-height': '250px' }"
                  [style]="{ width: '100%' }"
                  (onChange)="selectVases($event)"
                >
                </p-listbox>
              </div>
              <div class="col-9">
                <table *ngIf="allVases" class="table">
                  <thead>
                    <tr class="table-active">
                      <th scope="col">{{ l('name') }}</th>
                      <th scope="col">{{ l('count') }}</th>
                      <th scope="col">{{ l('amount') }}</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr *ngFor="let item of selectedVases; index as i">
                      <td>
                        {{ selectedVasesProperties[item.vasId].vasName }}
                      </td>
                      <td>
                        <input
                          type="number"
                          [attr.disabled]="!selectedVasesProperties[item.vasId].vasCountDisabled || null"
                          id="Vas-Count{{ i }}"
                          [(ngModel)]="item.requestMaxCount"
                          (keypress)="numberOnly($event)"
                          class="form-control"
                          name="Vas-Count{{ i }}"
                        />
                      </td>
                      <td>
                        <input
                          [attr.disabled]="!selectedVasesProperties[item.vasId].vasAmountDisabled || null"
                          type="number"
                          id="Vas-Amount{{ i }}"
                          [(ngModel)]="item.requestMaxAmount"
                          (keypress)="numberOnly($event)"
                          class="form-control"
                          name="Vas-Amount{{ i }}"
                        />
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
            <!--  end of Vas::Details-->
          </div>

          <!--  end of card::body-->

          <!--  start of card::form-->
        </div>
        <!--    start::Btns   -->
        <div class="container-fluid">
          <div class="row">
            <div class="col-lg-12 float-right mt-2">
              <button
                (click)="save()"
                [busyText]="l('SavingWithThreeDot')"
                [buttonBusy]="saving"
                [disabled]="!shippingRequestForm.form.valid"
                class="btn btn-danger font-weight-bold font-size-h6 px-10 float-right"
              >
                <i class="flaticon2-tag"></i>
                <span> {{ shippingRequest.id ? l('UpdateSippingRequest') : l('createShippingRequest') }}</span>
              </button>
            </div>
          </div>
        </div>
        <!--   end::Btns  -->
      </form>
    </div>
  </div>
</div>
