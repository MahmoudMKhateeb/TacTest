<div
  bsModal
  #addNewTripsModal="bs-modal"
  class="modal fade"
  role="dialog"
  tabindex="-1"
  aria-labelledby="createOrEditModal"
  aria-hidden="true"
  [config]="{ backdrop: 'static' }"
>
  <div class="modal-dialog modal-dialog-centered modal-xl">
    <div class="modal-content">
      <form *ngIf="active" #shippingRequestTripsForm="ngForm" novalidate autocomplete="off">
        <div class="modal-header">
          <p class="modal-title">
            <span>{{ l('TripDetails') }}</span>
          </p>
          <div class="card-toolbar">
            <button class="btn btn-primary" *ngIf="trip.id" [disabled]="!trip.id" (click)="DownloadSingleDropWaybillPdf(trip.id)">
              {{ l('PrintWaybill') }}
            </button>
          </div>
        </div>
        <div class="modal-body" [busyIf]="loading">
          <div class="row">
            <!--begin::Body-->
            <!--  begin:: Source Dest Facilitys  -->
            <div class="col-lg-6 form-group">
              <label>{{ l('SourceFacility') }} <span class="required-fileds">*</span></label>
              <div class="input-group">
                <select
                  #sourceFacility="ngModel"
                  name="sourceFacility"
                  class="form-control"
                  [disabled]="facilityLoading"
                  [(ngModel)]="trip.originFacilityId"
                  [class.is-invalid]="sourceFacility.touched && !sourceFacility.valid"
                  [class.is-valid]="sourceFacility.touched && sourceFacility.valid"
                  (change)="PointsComponent.sourceTripFacilityId = trip.originFacilityId"
                  required
                >
                  <option [ngValue]="null" selected disabled>{{ l('SelectaFacility') }}</option>
                  <option *ngFor="let item of allFacilities" value="{{ item.id }}">{{ item.displayName }}</option>
                </select>
                <div class="input-group-btn">
                  <button class="btn btn-primary" [disabled]="facilityLoading" (click)="createOrEditFacilityModal.show()">
                    <i class="flaticon-plus"></i>{{ l('AddNew') }}
                  </button>
                </div>
              </div>
            </div>
            <div class="col-lg-6 form-group">
              <label>{{ l('DestFacility') }} <span class="required-fileds">*</span></label>
              <div class="input-group">
                <select
                  #destFacility="ngModel"
                  name="destFacility"
                  class="form-control"
                  [disabled]="facilityLoading"
                  [(ngModel)]="trip.destinationFacilityId"
                  [class.is-invalid]="destFacility.touched && !destFacility.valid"
                  [class.is-valid]="destFacility.touched && destFacility.valid"
                  required
                >
                  <option [ngValue]="null" selected disabled>{{ l('SelectaFacility') }}</option>
                  <option *ngFor="let item of allFacilities" value="{{ item.id }}">{{ item.displayName }}</option>
                </select>
                <div class="input-group-btn">
                  <button class="btn btn-primary" [disabled]="facilityLoading" (click)="createOrEditFacilityModal.show()">
                    <i class="flaticon-plus"></i>{{ l('AddNew') }}
                  </button>
                </div>
              </div>
            </div>
            <!--  end:: Source Dest Facilitys  -->
            <!--  begin:: Trip start&End Dates-->
            <div class="col-lg-6">
              <div class="form-group">
                <label>{{ l('TripStartDate') }} <span class="required-fileds">*</span></label>
                <div class="input-group date">
                  <input
                    #startTripDate="ngModel"
                    [(ngModel)]="trip.startTripDate"
                    class="form-control"
                    [(date)]="trip.startTripDate"
                    name="tripStartDate"
                    bsDatepicker
                    datePickerMomentModifier
                  />

                  <div class="input-group-append">
                    <span class="input-group-text">
                      <i class="la la-calendar-check-o"></i>
                    </span>
                  </div>
                </div>
              </div>
            </div>
            <div class="col-lg-6">
              <div class="form-group">
                <label
                  >{{ l('TripEndDate') }}
                  <!--                    <span class="required-fileds">*</span>-->
                </label>
                <div class="input-group date">
                  <input
                    #endTripDate="ngModel"
                    [(ngModel)]="trip.endTripDate"
                    [(date)]="trip.endTripDate"
                    class="form-control"
                    name="tripEndDate"
                    placeholder="{{ l('TripEndDate') }}"
                    [minDate]="trip.startTripDate"
                    [maxDate]="shippingRequest.endTripDate"
                    (dateChange)="validateTripDates()"
                    [class.is-invalid]="endTripDate.touched && !endTripDate.valid"
                    [class.is-valid]="endTripDate.touched && endTripDate.valid"
                    required
                    bsDatepicker
                    datePickerMomentModifier
                  />
                  <div class="input-group-append">
                    <span class="input-group-text">
                      <i class="la la-calendar-check-o"></i>
                    </span>
                  </div>
                </div>
              </div>
            </div>
            <!--  end:: Trip start&End Dates-->
            <!-- begin::Vas's  -->
            <div class="col-lg-6" *ngIf="VasListFromFather?.length > 0">
              <div class="form-group" *ngIf="selectedVases != []">
                <label>{{ l('vases') }}</label>
                <p-multiSelect
                  name="shippingRequestTripVases"
                  [options]="Vases"
                  [(ngModel)]="trip.shippingRequestTripVases"
                  [styleClass]="'form-control'"
                  [filter]="false"
                  [showHeader]="false"
                  [defaultLabel]="''"
                  optionLabel="name"
                ></p-multiSelect>
              </div>
            </div>

            <div class="col-lg-6">
              <div class="form-group">
                <div class="checkbox-list">
                  <label class="checkbox">
                    <input type="checkbox" [(ngModel)]="trip.needsDeliveryNote" name="Checkboxes1" />
                    <span></span>{{ l('NeedsDeliveryNote') }}</label
                  >
                </div>
              </div>
            </div>

            <div class="col-lg-6">
              <div class="form-group">
                <div class="checkbox-list">
                  <label class="checkbox">
                    <input type="checkbox" [(ngModel)]="trip.hasAttachment" name="Checkboxes2" />
                    <span></span>{{ l('HasAttachment') }}</label
                  >
                </div>
              </div>
            </div>

            <!--      end:Vas's      -->
            <!--  start:: RouteSteps -->
            <PointsComponent
              #PointsComponent
              (SelectedWayPointsFromChild)="trip.routPoints = $event"
              [WayPointListFromFatherForShippingRequestEdit]="trip.routPoints"
              [MainGoodsCategory]="shippingRequest.goodCategoryId"
              [NumberOfDrops]="shippingRequest.numberOfDrops"
            ></PointsComponent>
            <!--  end:: RouteSteps -->
            <!--end::Body-->
          </div>
          <div class="modal-footer">
            <!--begin::Buttons-->

            <button [disabled]="saving" type="button" class="btn btn-secondary font-weight-bolder btn-sm py-3 px-6 text-uppercase" (click)="close()">
              {{ l('Close') }}
            </button>

            <button
              type="submit"
              [disabled]="saving || !shippingRequestTripsForm.form.valid"
              class="btn btn-primary font-weight-bolder btn-sm py-3 px-6 text-uppercase"
              (click)="createOrEditTrip()"
            >
              {{ trip.id ? l('UpdateTrip') : l('AddNewTrip') }}
            </button>
            <!--end::Buttons-->
          </div>
        </div>
      </form>
    </div>
  </div>
</div>
<createOrEditFacilityModal #createOrEditFacilityModal (modalSave)="refreshOrGetFacilities()"> </createOrEditFacilityModal>
