<div
  bsModal
  #addNewTripsModal="bs-modal"
  class="modal fade"
  role="dialog"
  tabindex="-1"
  aria-labelledby="createOrEditModal"
  aria-hidden="true"
  [config]="{ backdrop: 'static' }"
>
  <div class="modal-dialog modal-dialog-centered modal-xl">
    <div class="modal-content">
      <form *ngIf="active" #shippingRequestTripsForm="ngForm" novalidate autocomplete="off">
        <div class="modal-header">
          <p class="modal-title">
            <span>{{ l('TripDetails') }}</span>
          </p>
          <div class="card-toolbar">
            <button
              class="btn btn-primary"
              *ngIf="trip.id"
              [disabled]="!trip.id"
              (click)="DownloadSingleDropWaybillPdf(trip.id)"
              [buttonBusy]="wayBillIsDownloading"
            >
              <i class="fa flaticon2-print"></i>
              {{ l('PrintWaybill') }}
            </button>
          </div>
        </div>
        <div class="modal-body" [busyIf]="loading">
          <div class="row">
            <!--begin::Body-->
            <!--  begin:: Source Dest Facilitys  -->
            <div class="col-lg-6 form-group">
              <label>{{ l('SourceFacility') }} <span class="required-fileds">*</span></label>
              <div class="input-group">
                <select
                  #sourceFacility="ngModel"
                  name="sourceFacility"
                  class="form-control"
                  [disabled]="facilityLoading"
                  [(ngModel)]="trip.originFacilityId"
                  [class.is-invalid]="sourceFacility.touched && !sourceFacility.valid"
                  [class.is-valid]="sourceFacility.touched && sourceFacility.valid"
                  (ngModelChange)="ValidateTripFacilities()"
                  (change)="SyncFacilitiesWithService()"
                  required
                >
                  <option value="" selected>{{ l('SelectaFacility') }}</option>
                  <option *ngFor="let item of allFacilities" value="{{ item.id }}">{{ item.displayName }}</option>
                </select>
                <div class="input-group-btn">
                  <button class="btn btn-primary" [disabled]="facilityLoading" (click)="createOrEditFacilityModal.show()">
                    <i class="flaticon-plus"></i>{{ l('AddNew') }}
                  </button>
                </div>
              </div>
            </div>
            <div class="col-lg-6 form-group">
              <label> {{ l('DestFacility') }} <span class="required-fileds">*</span></label>
              <div class="input-group">
                <select
                  #destFacility="ngModel"
                  name="destFacility"
                  class="form-control"
                  [disabled]="facilityLoading"
                  [(ngModel)]="trip.destinationFacilityId"
                  [class.is-invalid]="destFacility.touched && !destFacility.valid"
                  [class.is-valid]="destFacility.touched && destFacility.valid"
                  (ngModelChange)="ValidateTripFacilities()"
                  (change)="SyncFacilitiesWithService()"
                  required
                >
                  <option value="" selected>{{ l('SelectaFacility') }}</option>
                  <option *ngFor="let item of allFacilities" value="{{ item.id }}">{{ item.displayName }}</option>
                </select>
                <div class="input-group-btn">
                  <button class="btn btn-primary" [disabled]="facilityLoading" (click)="createOrEditFacilityModal.show()">
                    <i class="flaticon-plus"></i>{{ l('AddNew') }}
                  </button>
                </div>
                <div class="invalid-feedback">{{ l('PickupFacilityAndDropOffFacilityCantBeTheSame') }}</div>
              </div>
            </div>
            <!--  end:: Source Dest Facilitys  -->
            <!--  begin:: Trip start&End Dates-->
            <div class="col-lg-6">
              <div class="form-group">
                <label>{{ l('TripsStartDate') }} <span class="required-fileds">*</span> </label>
                <div class="input-group date">
                  <input
                    id="tripStartDate"
                    [formControl]="tripStartDate"
                    type="text"
                    class="form-control"
                    name="tripStartDate"
                    bsDatepicker
                    datePickerMomentModifier
                    [class.is-valid]="tripStartDate.valid && tripStartDate.value"
                    [(date)]="trip.startTripDate"
                    [minDate]="shippingRequest.startTripDate"
                    [maxDate]="shippingRequest.startTripDate"
                    [bsConfig]="{ adaptivePosition: true }"
                    readonly="readonly"
                    required
                  />
                  <div class="input-group-append">
                    <span class="input-group-text">
                      <i class="la la-calendar-check-o"></i>
                    </span>
                  </div>
                </div>
              </div>
            </div>
            <div class="col-lg-6">
              <div class="form-group">
                <label> {{ l('TripsEndDate') }} </label>
                <div class="input-group date">
                  <input
                    id="endTripDate"
                    [formControl]="endTripDate"
                    type="text"
                    class="form-control"
                    name="endTripDate"
                    bsDatepicker
                    datePickerMomentModifier
                    [class.is-invalid]="trip.endTripDate && endTripDate.touched && !endTripDate.valid"
                    [class.is-valid]="trip.endTripDate && endTripDate.touched && endTripDate.valid"
                    [(date)]="trip.endTripDate"
                    [minDate]="trip.startTripDate"
                    [maxDate]="shippingRequest.endTripDate"
                    [bsConfig]="{ adaptivePosition: true }"
                    readonly="readonly"
                  />
                  <div class="input-group-append">
                    <span class="input-group-text">
                      <i class="la la-calendar-check-o"></i>
                    </span>
                  </div>
                </div>
              </div>
            </div>
            <!--  end:: Trip start&End Dates-->
            <!-- begin::Vas's  -->
            <div class="col-lg-6" *ngIf="VasListFromFather?.length > 0">
              <div class="form-group">
                <label>{{ l('vases') }}</label>
                <p-multiSelect
                  name="shippingRequestTripVases"
                  [options]="cleanVasesList"
                  [(ngModel)]="trip.shippingRequestTripVases"
                  (ngModelChange)="isSelectedVasesHasinsurance($event)"
                  [style]="{ width: '100%' }"
                  styleClass="form-control pt-1"
                  tooltipPositionStyle="dropdown-menu"
                  [filter]="true"
                  [showHeader]="true"
                  [dataKey]="'shippingRequestVasId'"
                  optionLabel="name"
                ></p-multiSelect>
              </div>
            </div>
            <!--      end:Vas's      -->

            <!--  begin::Trip Goods Approximate Value -->
            <div class="col-lg-6">
              <div class="form-group">
                <label>{{ l('ApproximateTripGoodsValue') }} <span class="required-fileds" *ngIf="isApproximateValueRequired">*</span></label>
                <div class="input-group date">
                  <input
                    #approximateGoodsTotalValue="ngModel"
                    type="number"
                    class="form-control"
                    name="approximateGoodsTotalValue"
                    (keypress)="numberOnly($event)"
                    [(ngModel)]="trip.totalValue"
                    [min]="1"
                    [class.is-invalid]="isApproximateValueRequired && approximateGoodsTotalValue.touched && !approximateGoodsTotalValue.valid"
                    [class.is-valid]="isApproximateValueRequired && approximateGoodsTotalValue.touched && approximateGoodsTotalValue.valid"
                    [required]="isApproximateValueRequired"
                  />
                  <div class="input-group-append">
                    <span class="input-group-text">
                      <i class="la la-dollar"></i>
                    </span>
                  </div>
                </div>
              </div>
            </div>
            <!--  end::Trip Goods Approximate Value -->
            <!--       start:: Notes       -->
            <div class="col-lg-12">
              <label>{{ l('Notes') }}</label>
              <div class="input-group">
                <textarea
                  #notes="ngModel"
                  name="notes"
                  class="form-control"
                  [maxlength]="512"
                  [(ngModel)]="trip.note"
                  [class.is-valid]="notes.touched && notes.valid && notes.value?.length != 0"
                  [class.is-invalid]="notes.touched && !notes.valid"
                ></textarea>
              </div>
            </div>
            <!--End :: notes-->
            <div class="col-lg-6 mt-4">
              <div class="form-group row">
                <div class="col-6 col-form-label">
                  <div class="checkbox-inline">
                    <label class="checkbox checkbox-danger">
                      <input type="checkbox" name="trip.needsDeliveryNote" [(ngModel)]="trip.needsDeliveryNote" />
                      <span></span>
                      {{ l('NeedsDeliveryNote') }}
                    </label>
                  </div>
                </div>
                <div class="col-6 col-form-label">
                  <div class="checkbox-inline float-right">
                    <label class="checkbox checkbox-danger">
                      <input type="checkbox" name="trip.hasAttachment" [(ngModel)]="trip.hasAttachment" />
                      <span></span>
                      {{ l('HasAttachment') }}
                    </label>
                  </div>
                </div>
              </div>
            </div>
            <div *ngIf="trip.hasAttachment" class="col-lg-6 mt-4">
              <label>{{ l('SelectFile') }} {{ fileToken }} </label>
              <div class="custom-file">
                <input
                  (change)="DocFileChangeEvent($event, trip.createOrEditDocumentFileDto)"
                  type="file"
                  class="custom-file-input"
                  accept="image/x-png,image/jpeg,application/pdf"
                  required
                />
                <label class="custom-file-label text-truncate" [for]="trip.createOrEditDocumentFileDto?.name">
                  {{ trip.createOrEditDocumentFileDto?.name ? trip.createOrEditDocumentFileDto?.name : l('SelectFile') }}</label
                >
              </div>
              <div class="margin-top-5">
                <p-progressBar [value]="docProgress" [style]="{ height: '6px', width: '100' }"></p-progressBar>
              </div>
            </div>
            <!--  start:: RouteSteps -->
            <PointsComponent #PointsComponent (SelectedWayPointsFromChild)="trip.routPoints = $event"></PointsComponent>
            <!--  end:: RouteSteps -->
            <!--end::Body-->
          </div>
          <div class="modal-footer">
            <!--begin::Buttons-->

            <button [disabled]="saving" type="button" class="btn btn-primary font-weight-bolder btn-sm py-3 px-6" (click)="close()">
              {{ l('Close') }}
            </button>

            <button
              type="submit"
              [disabled]="saving || !shippingRequestTripsForm.form.valid || tripStartDate.invalid || endTripDate.invalid"
              class="btn btn-primary font-weight-bolder btn-sm py-3 px-6"
              (click)="createOrEditTrip()"
            >
              {{ trip.id ? l('UpdateTrip') : l('AddNewTrip') }}
            </button>
            <!--end::Buttons-->
          </div>
        </div>
      </form>
    </div>
  </div>
</div>
<createOrEditFacilityModal #createOrEditFacilityModal (modalSave)="refreshOrGetFacilities($event)"> </createOrEditFacilityModal>
