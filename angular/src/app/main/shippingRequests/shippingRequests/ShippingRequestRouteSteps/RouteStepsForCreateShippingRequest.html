<div>
  <div class="card card-custom">
    <div class="card-header">
      <h3 class="card-title">
        wayPoints
      </h3>
      <div class="card-toolbar">
        <button type="button" class="btn btn-primary blue" (click)="createRouteStepModal.show()">
          <i class="fa fa-plus"></i>
          Add New WayPoint
        </button>
      </div>
    </div>
    <!--begin::Form-->
    <form class="form">
      <div class="card-body">
        <!--  Start::forViewAllRouteStepsMap (WayPoints)-->
        <div class="col-lg-12">
          <agm-map [latitude]="lat" [longitude]="lng" [zoom]="13">
            <agm-direction [origin]="wayPointMapSource" [destination]="wayPointMapDest" [waypoints]="wayPoints"></agm-direction>
          </agm-map>
        </div>
        <!--   End::forViewAllRouteStepsMap  -->
        <!--  begin::Table -->
        <div class="row">
          <div class="col-lg-6"></div>
          <div class="col-lg-12 mt-4">
            <div class="row align-items-center">
              <!--<Primeng-Datatable-Start>-->
              <div [busyIf]="primengTableHelper.isLoading" class="primeng-datatable-container col-12">
                <p-table
                  ScrollWidth="100%"
                  [paginator]="false"
                  [resizableColumns]="primengTableHelper.resizableColumns"
                  [responsive]="primengTableHelper.isResponsive"
                  [scrollable]="true"
                  [value]="wayPointsList"
                  rows="{{ primengTableHelper.defaultRecordsCountPerPage }}"
                >
                  <ng-template pTemplate="header">
                    <tr>
                      <th style="width: 130px;">
                        {{ l('Actions') }}
                      </th>
                      <th pSortableColumn="goodCategoryFk.displayName" style="width: 150px;">
                        {{ l('Source') }}
                        <p-sortIcon field="goodCategoryDisplayName"></p-sortIcon>
                      </th>
                      <th pSortableColumn="goodCategoryFk.displayName" style="width: 150px;">
                        {{ l('Destination') }}
                        <p-sortIcon field="goodCategoryDisplayName"></p-sortIcon>
                      </th>
                    </tr>
                  </ng-template>
                  <ng-template let-record="$implicit" pTemplate="body" let-i="rowIndex">
                    <tr>
                      <td style="width: 130px;">
                        <div class="btn-group dropdown" container="body" dropdown>
                          <button class="dropdown-toggle btn btn-sm btn-primary" dropdownToggle>
                            <i class="fa fa-cog"></i><span class="caret"></span> {{ l('Actions') }}
                          </button>
                          <ul *dropdownMenu class="dropdown-menu">
                            <li>
                              <a class="dropdown-item" (click)="AddRouteStep(i)">{{ l('Edit') }}</a>
                            </li>
                            <li>
                              <a class="dropdown-item" (click)="delete(i)">{{ l('Delete') }}</a>
                            </li>
                          </ul>
                        </div>
                      </td>
                      <td style="width: 150px;">
                        <span class="ui-column-title"> {{ l('DisplayName') }}</span>
                        {{ record.displayName }}
                      </td>

                      <td style="width: 150px;">
                        <span class="ui-column-title"> {{ l('DisplayName') }}</span>
                        {{ record .displayName }}
                      </td>
                    </tr>
                  </ng-template>
                </p-table>
                <div *ngIf="wayPointsList.length == 0" class="primeng-no-data">
                  {{ l('NoData') }}
                </div>
              </div>
              <!--<Primeng-Datatable-End>-->
            </div>
          </div>
        </div>
        <!--  end::table  -->
      </div>
    </form>
    <!--end::Form-->
  </div>
  <!--begin::Create::RouteStepModal-->
  <div
    class="modal fade"
    bsModal
    #createRouteStepModal="bs-modal"
    [config]="{ backdrop: 'static' }"
    tabindex="-1"
    role="dialog"
    aria-labelledby="dialog-static-name"
  >
    <div class="modal-dialog modal-xl">
      <div class="modal-content">
        <div class="modal-header">
          <h4 class="modal-title">
            <!--                <span *ngIf="routStep.id">{{l("EditRoutStep")}}</span>-->
            <!--                <span *ngIf="!routStep.id">{{l("CreateNewRoutStep")}}</span>-->
            {{ l('addNewWayPoint') }}
          </h4>
        </div>
        <div class="modal-body">
          <div class="row mb-4">
            <!-- start:: map that draws the RouteStep::Route in CreateOrEditRouteStep-->
            <div class="col-lg-12">
              <!--              <agm-map [latitude]="lat" [longitude]="lng">-->
              <!--                <agm-direction-->
              <!--                  *ngIf="dir.origin.lat && dir.origin.lng && dir.destination.lat && dir.destination.lng"-->
              <!--                  [origin]="dir.origin"-->
              <!--                  [destination]="dir.destination"-->
              <!--                ></agm-direction>-->
              <!--              </agm-map>-->
              <agm-map [latitude]="singleWayPoint.latitude || lat" [longitude]="singleWayPoint.longitude || lng" [zoom]="zoom">
                <agm-marker [latitude]="singleWayPoint.latitude" [longitude]="singleWayPoint.longitude"></agm-marker>
              </agm-map>
            </div>
            <!-- END::map that draws the RouteStep::Route in CreateOrEditRouteStep-->
          </div>
          <div class="row p-0 mt-4">
            <div class="col-lg-12 row">
              <div class="form-group col-lg-6">
                <label>{{ l('address') }}</label>
                <div
                  [ngClass]="{'spinner spinner-success spinner-right mr-1 ml-1': facilityLoading
                            }"
                >
                  <div class="input-group">
                    <select
                      name="Facility1"
                      class="form-control"
                      [(ngModel)]="singleWayPoint.facilityId"
                      [disabled]="facilityLoading"
                      (change)="RouteStepCordSetter()"
                    >
                      <option value="">{{ l('selectaFacility') }}</option>
                      <option *ngFor="let item of allFacilities" value="{{ item.id }}">{{ item.displayName }}</option>
                    </select>
                    <div class="input-group-append">
                      <button class="btn btn-primary" type="button" (click)="openCreateFacilityModal()">+</button>
                    </div>
                  </div>
                </div>
              </div>

              <div class="form-group col-lg-6">
                <label>pickingType</label>
                <div class="input-icon input-icon-right">
                  <select name="PickingType1" class="form-control" [(ngModel)]="singleWayPoint.pickingTypeId">
                    <option value="">{{ l('SelectPickingType') }}</option>
                    <option [ngValue]="1">PickUp</option>
                    <option [ngValue]="2">Drop</option>
                  </select>
                </div>
              </div>

              <!--    StartOF::GoodDetailsSection       -->
              <div>
                <div class="card card-custom gutter-b">
                  <div class="card-header">
                    <h3 class="card-title">
                      {{ l('goodsDetails')}}
                    </h3>
                    <div class="card-toolbar">
                      <button type="button" class="btn btn-primary blue" (click)="openAddNewGoodDetailModal()" [disabled]="!MainGoodsCategory">
                        <i class="fa fa-plus"></i>
                        {{ l('addNewGoodDetails') }}
                      </button>
                    </div>
                  </div>
                  <div class="card-body">
                    <div class="row align-items-center">
                      <!--<Primeng-Datatable-Start>-->
                      <div [busyIf]="primengTableHelper.isLoading" class="primeng-datatable-container col-12">
                        <p-table
                          ScrollWidth="100%"
                          [paginator]="false"
                          [resizableColumns]="primengTableHelper.resizableColumns"
                          [responsive]="primengTableHelper.isResponsive"
                          [scrollable]="true"
                          [value]="singleWayPoint.goodsDetailListDto"
                          rows="{{ primengTableHelper.defaultRecordsCountPerPage }}"
                        >
                          <ng-template pTemplate="header">
                            <tr>
                              <th style="width: 130px;">
                                {{ l('Actions') }}
                              </th>
                              <th pSortableColumn="goodCategoryFk.displayName" style="width: 150px;">
                                {{ l('GoodsName') }}
                                <p-sortIcon field="goodCategoryDisplayName"></p-sortIcon>
                              </th>
                              <th pSortableColumn="goodCategoryFk.displayName" style="width: 150px;">
                                {{ l('Amount') }}
                                <p-sortIcon field="goodCategoryDisplayName"></p-sortIcon>
                              </th>
                              <th pSortableColumn="goodCategoryFk.displayName" style="width: 150px;">
                                {{ l('weight') }}
                                <p-sortIcon field="goodCategoryDisplayName"></p-sortIcon>
                              </th>
                            </tr>
                          </ng-template>
                          <ng-template let-record="$implicit" pTemplate="body" let-i="rowIndex">
                            <tr>
                              <td style="width: 130px;">
                                <div class="btn-group dropdown">
                                  <button class="btn font-weight-bold btn-danger btn-icon float-right" (click)="DeleteGoodDetail(i)">
                                    <i class="la la-trash float-right"></i>
                                  </button>
                                </div>
                              </td>
                              <td style="width: 150px;">
                                <span class="ui-column-title"> {{ l('goodCategoryId') }}</span>
                                {{ record.goodCategoryId }}
                              </td>
                              <td style="width: 150px;">
                                <span class="ui-column-title"> {{ l('totalAmount') }}</span>
                                {{ record.totalAmount }}
                              </td>
                              <td style="width: 150px;">
                                <span class="ui-column-title"> {{ l('weight') }}</span>
                                {{ record.weight }}
                              </td>
                            </tr>
                          </ng-template>
                        </p-table>
                        <div *ngIf="singleWayPoint?.goodsDetailListDto?.length == 0" class="primeng-no-data">
                          {{ l('NoData') }}
                        </div>
                      </div>
                      <!--<Primeng-Datatable-End>-->
                    </div>
                  </div>
                </div>
              </div>

              <!--     Endof::GoodDetailsSection           -->
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button [disabled]="saving" type="button" class="btn btn-default" (click)="createRouteStepModal.hide()">{{ l('Cancel') }}</button>
          <button
            type="submit"
            class="btn btn-primary blue"
            [buttonBusy]="saving"
            [busyText]="l('SavingWithThreeDot')"
            (click)="routeStepIdForEdit === undefined ?  AddRouteStep() : EditRouteStep(routeStepIdForEdit)"
          >
            <i class="fa fa-save"></i> <span>{{ l('Save') }}</span>
          </button>
        </div>
      </div>
    </div>
  </div>
  <!--end::Create::RouteStepModal-->
  <!--begin::FacilityModal-->
  <div
    class="modal fade"
    bsModal
    #createFacilityModal="bs-modal"
    [config]="{ backdrop: 'static' }"
    tabindex="-1"
    role="dialog"
    aria-labelledby="dialog-static-name"
  >
    <div class="modal-dialog modal-xl">
      <div class="modal-content">
        <form #createFacilityForm="ngForm" novalidate (ngSubmit)="createFacility()" autocomplete="off">
          <div class="modal-header">
            <h4 class="modal-title">
              <!--                <span *ngIf="routStep.id">{{l("EditRoutStep")}}</span>-->
              <!--                <span *ngIf="!routStep.id">{{l("CreateNewRoutStep")}}</span>-->
              {{ l('CreateFacilityModal') }}
            </h4>
            <button type="button" class="close" (click)="openCreateFacilityModal()" aria-label="Close" [disabled]="saving">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>

          <div class="modal-body">
            <div class="row">
              <div class="form-group col-md-12">
                <label for="Facility_Name">{{ l('facilityName') }} *</label>
                <input
                  type="text"
                  id="Facility_Name"
                  class="form-control"
                  [(ngModel)]="facility.name"
                  name="Name"
                  minlength="0"
                  maxlength="256"
                  required
                />
              </div>

              <div class="form-group col-md-2">
                <label>{{ l('selectaCountry') }}</label>
                <select name="selectaCountry" [(ngModel)]="selectedCountryCode" class="form-control" (change)="loadMapApi()">
                  <option value="">{{ l('SelectACounty') }}</option>
                  <option ngValue="SA">Saudi Arabia</option>
                  <option ngValue="EG">Egypt</option>
                  <option ngValue="FR">France</option>
                </select>
              </div>
              <div class="form-group col-md-10">
                <label>{{ l('searchForLocation') }}</label>
                <input
                  type="text"
                  class="form-control"
                  (keydown.enter)="$event.preventDefault()"
                  placeholder="Search Nearest Location"
                  autocorrect="off"
                  autocapitalize="off"
                  [disabled]="!selectedCountryCode"
                  name="searchForAddress"
                  spellcheck="off"
                  type="text"
                  #search
                />
              </div>
              <!-- CreateNewFacilityMap -->
              <div class="form-group col-md-12">
                <agm-map [latitude]="facility.latitude" [longitude]="facility.longitude" [zoom]="zoom" (mapClick)="mapClicked($event)">
                  <agm-marker
                    [latitude]="facility.latitude"
                    [longitude]="facility.longitude"
                    [markerDraggable]="true"
                    (dragEnd)="mapClicked($event)"
                  ></agm-marker>
                </agm-map>
              </div>
              <!-- CreateNewFacilityMap -->

              <!--                        <div class="form-group m-form__group">-->
              <!--                            <label for="CountyDisplayName">{{ l('County') }}</label>-->
              <!--                            <select name="facility.countyId" [(ngModel)]="facility.countyId" class="form-control" required>-->
              <!--                                <option value="">{{ l('SelectACounty') }}</option>-->
              <!--                                <option *ngFor="let item of allCountries" value="{{ item.id }}">{{ item.displayName }}</option>-->
              <!--                            </select>-->
              <!--                        </div>-->

              <!--            <div class="form-group m-form__group col-md-6">-->
              <!--              <label for="facility.cityId">{{ l('City') }}</label>-->
              <!--              <select name="facility.cityId" id="facility.cityId" [(ngModel)]="facility.cityId" class="form-control" required>-->
              <!--                <option value="">{{ l('SelectACity') }}</option>-->
              <!--                <option *ngFor="let item of allCitys" value="{{ item.id }}">{{ item.displayName }}</option>-->
              <!--              </select>-->
              <!--            </div>-->

              <!--            <div class="form-group col-md-6">-->
              <!--              <label for="Facility_Adress">{{ l('Adress') }} *</label>-->
              <!--              <input-->
              <!--                type="text"-->
              <!--                id="Facility_Adress"-->
              <!--                class="form-control"-->
              <!--                [(ngModel)]="facility.adress"-->
              <!--                name="Adress"-->
              <!--                minlength="0"-->
              <!--                maxlength="256"-->
              <!--                required-->
              <!--              />-->
              <!--            </div>-->

              <!--            <div class="form-group col-md-6">-->
              <!--              <label>{{ l('Address') }}</label>-->
              <!--              <input type="text" class="form-control"  name="address" />-->
              <!--            </div>-->
              <div class="form-group col-md-6">
                <label>{{ l('Address') }}</label>
                <input type="text" class="form-control" [(ngModel)]="Address" name="Address" />
              </div>
              <div class="form-group col-md-6">
                <label>{{ l('State') }}</label>
                <input type="text" class="form-control" [(ngModel)]="State" name="State" />
              </div>
              <div class="form-group col-md-6">
                <label>{{ l('City') }}</label>
                <input type="text" class="form-control" [(ngModel)]="City" name="City" />
              </div>

              <div class="form-group col-md-6">
                <label>{{ l('Country') }}</label>
                <input type="text" class="form-control" [(ngModel)]="Country" name="Country" />
              </div>
              <div class="form-group col-md-6">
                <label for="Facility_Longitude">{{ l('Longitude') }}</label>
                <input type="number" id="Facility_Longitude" class="form-control" [(ngModel)]="facility.longitude" name="Longitude" />
              </div>

              <div class="form-group col-md-6">
                <label for="Facility_Latitude">{{ l('Latitude') }}</label>
                <input type="number" id="Facility_Latitude" class="form-control" [(ngModel)]="facility.latitude" name="Latitude" />
              </div>
            </div>
          </div>
          <div class="modal-footer">
            <button [disabled]="saving" type="button" class="btn btn-default" (click)="createFacilityModal.hide()">{{ l('Cancel') }}</button>
            <button
              type="submit"
              class="btn btn-primary blue"
              [disabled]="!createFacilityForm.form.valid"
              [buttonBusy]="saving"
              [busyText]="l('SavingWithThreeDot')"
            >
              <i class="fa fa-save"></i> <span>{{ l('Save') }}</span>
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
  <!--end::FacilityModal-->
  <!-- begin::CreateNewGoodModal   -->
  <div
    #createOrEditGoodDetail="bs-modal"
    [config]="{ backdrop: 'static' }"
    aria-hidden="true"
    aria-labelledby="createOrEditGoodDetail"
    bsModal
    class="modal fade"
    role="dialog"
    tabindex="-1"
  >
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <form #goodsDetailForm="ngForm" (ngSubmit)="AddGoodDetail()" autocomplete="off" novalidate>
          <div class="modal-header">
            <h4 class="modal-title">
              <span>{{ l('addNewGoodDetail') }}</span>
            </h4>
            <button (click)="createOrEditGoodDetail.hide()" [disabled]="saving" aria-label="Close" class="close" type="button">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <div class="row">
              <!--<div class="form-group m-form__group">-->
              <div class="col-12">
                <div class="form-group row fv-plugins-icon-container">
                  <div class="col-lg-6">
                    <div class="form-group">
                      <label>* {{ l('GoodSubCategory') }}:</label>
                      <!--   TODO:// Add DataBining for DD-->
                      <div [ngClass]="{ 'spinner spinner-success spinner-right mr-1 ml-1': !allSubGoodCategorys }">
                        <!--                          <select select [(ngModel)]="goodsDetail.goodCategoryId" class="form-control" name="goodsDetail.goodCategoryId">-->
                        <select
                          [(ngModel)]="goodsDetail.goodCategoryId"
                          class="form-control"
                          name="goodsDetail.goodCategoryId"
                          [disabled]="!allSubGoodCategorys"
                        >
                          <option value="">{{ l('SelectAGoodSubCategory') }}</option>
                          <option *ngFor="let item of allSubGoodCategorys" value="{{ item.id }}">{{ item.displayName }}</option>
                        </select>
                      </div>
                      <span class="form-text text-muted">{{ l('selectaGoodCategory') }}</span>
                    </div>
                  </div>
                  <div class="col-lg-6">
                    <div class="form-group">
                      <label for="GoodsDetail_Quantity">{{ l('Amount') }}</label>
                      <input
                        [(ngModel)]="goodsDetail.amount"
                        class="form-control"
                        id="GoodsDetail_Quantity"
                        maxlength="128"
                        minlength="0"
                        name="Quantity"
                        type="text"
                      />
                    </div>
                  </div>
                  <div class="col-lg-6">
                    <div class="form-group">
                      <label for="GoodsDetail_Weight">{{ l('Weight') }}</label>
                      <input
                        [(ngModel)]="goodsDetail.weight"
                        class="form-control"
                        id="GoodsDetail_Weight"
                        maxlength="64"
                        minlength="0"
                        name="Weight"
                        type="text"
                      />
                    </div>
                  </div>
                  <div class="col-lg-6">
                    <div class="form-group">
                      <label for="GoodsDetail_Description">{{ l('Description') }}</label>
                      <input
                        [(ngModel)]="goodsDetail.description"
                        class="form-control"
                        id="GoodsDetail_Description"
                        maxlength="256"
                        minlength="0"
                        name="Description"
                        type="text"
                      />
                    </div>
                  </div>

                  <div class="col-lg-6">
                    <div class="form-group">
                      <label for="GoodsDetail_Dimentions">{{ l('Dimentions') }}</label>
                      <input
                        [(ngModel)]="goodsDetail.dimentions"
                        class="form-control"
                        id="GoodsDetail_Dimentions"
                        maxlength="128"
                        minlength="0"
                        name="Dimentions"
                        type="text"
                      />
                    </div>
                  </div>
                  <div class="col-lg-6 mt-10">
                    <div class="form-check checkbox-inline">
                      <label class="checkbox checkbox-danger">
                        <input
                          [(ngModel)]="goodsDetail.isDangerousGood"
                          id="GoodsDetail_IsDangerousGood"
                          name="IsDangerousGood"
                          type="checkbox"
                          checked="checked"
                        />
                        <span></span>
                        {{ l('IsDangerousGood') }}
                      </label>
                    </div>
                  </div>

                  <div class="col-lg-6">
                    <div class="form-group" [hidden]="!goodsDetail.isDangerousGood">
                      <label for="GoodsDetail_DangerousGoodsCode">{{ l('DangerousGoodsCode') }}</label>
                      <input
                        [(ngModel)]="goodsDetail.dangerousGoodsCode"
                        class="form-control"
                        id="GoodsDetail_DangerousGoodsCode"
                        maxlength="64"
                        minlength="0"
                        name="DangerousGoodsCode"
                        type="text"
                      />
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class="modal-footer">
            <button (click)="createOrEditGoodDetail.hide()" [disabled]="saving" class="btn btn-default" type="button">{{ l('Cancel') }}</button>
            <button
              [busyText]="l('SavingWithThreeDot')"
              [buttonBusy]="saving"
              [disabled]="!goodsDetailForm.form.valid"
              class="btn btn-save blue"
              type="submit"
            >
              <i class="fa fa-save"></i> <span>{{ l('Save') }}</span>
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- End::CreateNewGoodModal   -->
</div>
