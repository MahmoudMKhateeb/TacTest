<div
  bsModal
  #viewOrEditModal="bs-modal"
  class="modal fade"
  tabindex="-1"
  role="dialog"
  aria-labelledby="createOrEditModal"
  aria-hidden="true"
  [config]="{ backdrop: 'static' }"
>
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h4 class="modal-title">
          <span> {{ l(documentEntityFilter) }} {{ l('Documents') }}</span>
        </h4>
        <button type="button" class="close" (click)="close()" aria-label="Close" [disabled]="saving">
          <span aria-hidden="true">&times;</span>
        </button>

        <button
          *ngIf="isMissingDocumentFiles"
          (click)="createOrEditDocumentFileModal.show(entityIdFilter,documentEntityFilter,null)"
          class="btn btn-primary blue"
        >
          <i class="fa fa-plus"></i> {{ l('AddDocument') }}
        </button>
      </div>
      <div class="modal-body">
        <div class="row align-items-center">
          <div *ngIf="active" class="primeng-datatable-container col-12" [busyIf]="primengTableHelper.isLoading">
            <p-table
              #dataTable
              (onLazyLoad)="getDocumentFiles($event)"
              [value]="primengTableHelper.records"
              rows="{{ primengTableHelper.defaultRecordsCountPerPage }}"
              [paginator]="false"
              [lazy]="true"
              [scrollable]="true"
              ScrollWidth="100%"
              [responsive]="primengTableHelper.isResponsive"
              [resizableColumns]="primengTableHelper.resizableColumns"
            >
              <ng-template pTemplate="header">
                <tr>
                  <th style="width: 130px;" [hidden]="!isGrantedAny('Pages.DocumentFiles.Edit', 'Pages.DocumentFiles.Delete')">
                    {{ l('Actions') }}
                  </th>
                  <th style="width: 150px;" pSortableColumn="documentTypeFk.displayName">
                    {{ l('DocumentName') }}
                    <p-sortIcon field="documentTypeDisplayName"></p-sortIcon>
                  </th>
                  <th *ngIf="documentEntityFilter=='Truck'" style="width: 150px;" pSortableColumn="truckFk.truckId">
                    {{ l('TruckID') }}
                    <p-sortIcon field="truckId"></p-sortIcon>
                  </th>
                  <th *ngIf="documentEntityFilter=='Driver'" style="width: 150px;" pSortableColumn="userFk.userId">
                    {{ l('DriverName') }}
                    <p-sortIcon field="userId"></p-sortIcon>
                  </th>
                  <th style="width: 150px;" pSortableColumn="extn">
                    {{ l('Extn') }}
                    <p-sortIcon field="documentFile.extn"></p-sortIcon>
                  </th>

                  <th style="width: 150px;" pSortableColumn="number">
                    {{ l('Number') }}
                    <p-sortIcon field="Number"></p-sortIcon>
                  </th>

                  <th style="width: 150px;" pSortableColumn="expirationDate">
                    {{ l('ExpirationDate') }}
                    <p-sortIcon field="documentFile.expirationDate"></p-sortIcon>
                  </th>
                </tr>
              </ng-template>
              <ng-template pTemplate="body" let-record="$implicit">
                <tr>
                  <td style="width: 130px;" [hidden]="!isGrantedAny('Pages.DocumentFiles.Edit', 'Pages.DocumentFiles.Delete')">
                    <div class="btn-group dropdown" dropdown container="body">
                      <button type="button" class="dropdown-toggle btn btn-sm btn-primary" dropdownToggle>
                        <i class="fa fa-cog"></i><span class="caret"></span> {{ l('Actions') }}
                      </button>
                      <ul class="dropdown-menu" *dropdownMenu>
                        <!-- <li>
                    <a href="javascript:;" class="dropdown-item" (click)="viewDocumentFileModal.show(record)">{{ l('View') }}</a>
                  </li> -->
                        <li>
                          <a
                            href="javascript:;"
                            *ngIf="permission.isGranted('Pages.DocumentFiles.Edit')"
                            class="dropdown-item"
                            (click)="createOrEditDocumentFileModal.show(entityIdFilter,documentEntityFilter,record.documentFile.id)"
                            >{{ l('Edit') }}</a
                          >
                        </li>
                        <li>
                          <a class="dropdown-item" href="javascript:;" (click)="downloadDocument(record.documentFile)">{{ l('Download') }}</a>
                        </li>
                        <li>
                          <a
                            class="dropdown-item"
                            href="javascript:;"
                            *ngIf="permission.isGranted('Pages.DocumentFiles.Delete')"
                            (click)="deleteDocumentFile(record.documentFile)"
                            >{{ l('Delete') }}</a
                          >
                        </li>

                        <!-- <li>
                    <a href="javascript:;" *ngIf="entityHistoryEnabled" (click)="showHistory(record.documentFile)">{{ l('History') }}</a>
                  </li> -->
                      </ul>
                    </div>
                  </td>
                  <td style="width: 150px;">
                    <span class="ui-column-title"> {{ l('Document Name') }}</span>
                    {{ record.documentTypeDisplayName }}
                  </td>
                  <td *ngIf="documentEntityFilter=='Truck'" style="width: 150px;">
                    <span class="ui-column-title"> {{ l('TruckID') }}</span>
                    {{ record.truckId }}
                  </td>
                  <td *ngIf="documentEntityFilter=='Driver'" style="width: 150px;">
                    <span class="ui-column-title"> {{ l('DriverName') }}</span>
                    {{ record.userName }}
                  </td>

                  <td style="width: 150px;">
                    <span class="ui-column-title"> {{ l('Extn') }}</span>
                    {{ record.documentFile.extn }}
                  </td>

                  <td style="width: 150px;">
                    {{ record.hasNumber ? record.number : '--' }}
                  </td>

                  <td style="width: 150px;">
                    <span *ngIf="record.hasDate">
                      {{ record.documentFile.expirationDate | momentFormat: 'D/M/YYYY' }}
                    </span>
                    <span *ngIf="!record.hasDate">--</span>
                  </td>
                </tr>
              </ng-template>
            </p-table>
            <div class="primeng-no-data" *ngIf="primengTableHelper.totalRecordsCount == 0">
              {{ l('NoData') }}
            </div>
            <div class="primeng-paging-container">
              <p-paginator
                [rows]="primengTableHelper.defaultRecordsCountPerPage"
                #paginator
                (onPageChange)="getDocumentFiles($event)"
                [totalRecords]="primengTableHelper.totalRecordsCount"
                [rowsPerPageOptions]="primengTableHelper.predefinedRecordsCountPerPage"
              >
              </p-paginator>
              <span class="total-records-count">
                {{ l('TotalRecordsCount', primengTableHelper.totalRecordsCount) }}
              </span>
            </div>
          </div>
        </div>
        <!--<Primeng-Datatable-End>-->
      </div>
      <div class="modal-footer">
        <button [disabled]="saving" type="button" class="btn btn-default" (click)="close()">{{ l('Cancel') }}</button>
      </div>
    </div>
  </div>
  <createOrEditDocumentFileModal #createOrEditDocumentFileModal (modalSave)="getDocumentFiles()"></createOrEditDocumentFileModal>
</div>
