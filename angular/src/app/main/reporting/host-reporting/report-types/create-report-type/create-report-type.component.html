<div [@routerTransition]>
  <div class="content d-flex flex-column flex-column-fluid">
    <sub-header [title]="'CreateReportType' | localize" [description]="'' | localize"></sub-header>
    <div [class]="containerClass">
      <div class="card card-custom gutter-b">
        <div class="card-body">
          <!--begin: Wizard-->
          <div #wizard class="wizard wizard-3" id="kt_wizard_v3" data-wizard-state="first" data-wizard-clickable="true">
            <!--begin: Wizard Nav-->
            <div class="wizard-nav">
              <div class="wizard-steps px-8 py-8 px-lg-15 py-lg-3">
                <!--begin::Wizard Step 1 Nav-->
                <div class="wizard-step" data-wizard-type="step" data-wizard-state="current">
                  <div class="wizard-label">
                    <h3 class="wizard-title"><span>1.</span> {{ 'ReportTypeSetup' | localize }}</h3>
                    <div class="wizard-bar"></div>
                  </div>
                </div>
                <!--end::Wizard Step 1 Nav-->

                <!--begin::Wizard Step 2 Nav-->
                <div class="wizard-step" data-wizard-type="step" data-wizard-state="pending">
                  <div class="wizard-label">
                    <h3 class="wizard-title"><span>2.</span> {{ 'ReportAccessSetup' | localize }}</h3>
                    <div class="wizard-bar"></div>
                  </div>
                </div>
                <!--end::Wizard Step 2 Nav-->

                <!--begin::Wizard Step 3 Nav-->
                <div class="wizard-step" data-wizard-type="step" data-wizard-state="pending">
                  <div class="wizard-label">
                    <h3 class="wizard-title"><span>3.</span> {{ 'ReportDesigner' }}</h3>
                    <div class="wizard-bar"></div>
                  </div>
                </div>
                <!--end::Wizard Step 3 Nav-->
              </div>
            </div>
            <!--end: Wizard Nav-->

            <!--begin: Wizard Body-->
            <div class="row justify-content-center py-10 px-8 py-lg-12 px-lg-10">
              <div class="col-xl-12" [ngClass]="{ 'col-xxl-7': activeStep !== 2, 'col-xxl-10': activeStep === 2 }">
                <!--begin: Wizard Form-->
                <form class="form fv-plugins-bootstrap fv-plugins-framework" id="kt_form">
                  <!--begin: Wizard Step 1-->
                  <div class="pb-5" data-wizard-type="step-content" data-wizard-state="current">
                    <h4 class="mb-10 font-weight-bold text-dark">{{ 'ReportTypeSetup' | localize }}</h4>
                    <div class="d-flex">
                      <div class="form-group w-50">
                        <label>{{ 'ReportType' | localize }}</label>
                        <dx-select-box
                          id="type"
                          name="type"
                          [(value)]="reportDefinitionDto.type"
                          [dataSource]="allTypes"
                          [searchEnabled]="true"
                          displayExpr="value"
                          valueExpr="key"
                          placeholder="{{ l('SelectType') }}"
                        >
                        </dx-select-box>
                        <span class="form-text text-muted">{{ 'PleaseSelectType' | localize }}</span>
                      </div>
                      <div class="form-group w-50 ml-4">
                        <label>{{ 'ReportName' | localize }}</label>
                        <dx-text-box
                          id="reportName"
                          name="reportName"
                          [(value)]="reportDefinitionDto.displayName"
                          placeholder="{{ l('EnterReportName') }}"
                        >
                        </dx-text-box>
                        <span class="form-text text-muted">{{ 'PleaseEnterReportName' | localize }}</span>
                      </div>
                    </div>
                  </div>
                  <!--end: Wizard Step 1-->

                  <!--begin: Wizard Step 2-->
                  <div class="pb-5" data-wizard-type="step-content">
                    <h4 class="mb-10 font-weight-bold text-dark">{{ 'ReportAccessSetup' | localize }}</h4>
                    <div class="d-flex">
                      <div class="form-group w-50">
                        <label>{{ 'EditionType' | localize }}</label>
                        <p-multiSelect
                          #editionType="ngModel"
                          dropdownIcon="fa fa-caret-down"
                          name="editionType"
                          [options]="allEditionTypes"
                          [(ngModel)]="reportDefinitionDto.grantedEditionIds"
                          (onChange)="loadAllCompanies()"
                          [selectedItemsLabel]="'{0} items selected'"
                          [style]="{ width: '100%' }"
                          styleClass="form-control pt-1"
                          [dataKey]="'id'"
                          required
                          optionLabel="displayName"
                          [ngClass]="{
                            'is-invalid': editionType.invalid && (editionType.dirty || editionType.touched),
                            'is-valid': editionType.valid && (editionType.dirty || editionType.touched)
                          }"
                        >
                        </p-multiSelect>
                        <span class="form-text text-muted">{{ 'PleaseSelectEditionType' | localize }}</span>
                      </div>
                      <div class="form-group w-50 ml-4">
                        <label>{{ 'ExcludingCompanies' | localize }}</label>
                        <p-multiSelect
                          #excludingCompanies="ngModel"
                          dropdownIcon="fa fa-caret-down"
                          id="excludingCompanies"
                          name="excludingCompanies"
                          [options]="allCompanies"
                          [(ngModel)]="reportDefinitionDto.excludedTenantIds"
                          [selectedItemsLabel]="'{0} items selected'"
                          [style]="{ width: '100%' }"
                          styleClass="form-control pt-1"
                          [dataKey]="'id'"
                          required
                          placeholder="{{ l('SelectACompany') }}"
                          optionLabel="displayName"
                          [ngClass]="{
                            'is-invalid': excludingCompanies.invalid && (excludingCompanies.dirty || excludingCompanies.touched),
                            'is-valid': excludingCompanies.valid && (excludingCompanies.dirty || excludingCompanies.touched)
                          }"
                        >
                        </p-multiSelect>
                        <span class="form-text text-muted">{{ 'PleaseSelectEditionType' | localize }}</span>
                      </div>
                    </div>
                  </div>
                  <!--end: Wizard Step 2-->

                  <!--begin: Wizard Step 3-->
                  <div class="pb-5" data-wizard-type="step-content">
                    <!--  here will be the designer  -->
                    <h4 class="mb-10 font-weight-bold text-dark">{{ 'ReportDesigner' | localize }}</h4>
                    <dx-report-designer [reportUrl]="reportUrl" height="700px">
                      <dxrd-request-options [getDesignerModelAction]="getDesignerModelAction" [host]="hostUrl"></dxrd-request-options>
                      <dxrd-callbacks (ReportSaved)="reportDefinitionDto.reportTemplateUrl = reportUrl"></dxrd-callbacks>
                    </dx-report-designer>
                  </div>
                  <!--end: Wizard Step 3-->

                  <!--begin: Wizard Actions-->
                  <div class="d-flex justify-content-between border-top mt-5 pt-10">
                    <div class="mr-2">
                      <button type="button" class="btn btn-light-primary font-weight-bolder text-uppercase px-9 py-4" data-wizard-type="action-prev">
                        Previous
                      </button>
                    </div>
                    <div>
                      <button
                        type="button"
                        (click)="createOrEdit()"
                        class="btn btn-success font-weight-bolder text-uppercase px-9 py-4"
                        data-wizard-type="action-submit"
                      >
                        Submit
                      </button>
                      <button type="button" class="btn btn-primary font-weight-bolder text-uppercase px-9 py-4" data-wizard-type="action-next">
                        Next
                      </button>
                    </div>
                  </div>
                  <!--end: Wizard Actions-->
                  <div></div>
                  <div></div>
                  <div></div>
                  <div></div>
                </form>
                <!--end: Wizard Form-->
              </div>
            </div>
            <!--end: Wizard Body-->
          </div>
          <!--end: Wizard-->
        </div>
      </div>
    </div>
    <!--end::Container-->
  </div>
</div>
