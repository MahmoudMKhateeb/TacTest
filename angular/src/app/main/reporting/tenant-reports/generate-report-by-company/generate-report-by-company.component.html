<div [@routerTransition]>
  <div class="content d-flex flex-column flex-column-fluid">
    <sub-header [title]="'CreateReport' | localize" [description]="'' | localize"></sub-header>
    <div [class]="containerClass">
      <div class="card card-custom gutter-b">
        <div class="card-body">
          <!--begin: Wizard-->
          <div #wizard class="wizard wizard-3" id="kt_wizard_v3" data-wizard-state="first" data-wizard-clickable="true">
            <!--begin: Wizard Nav-->
            <div class="wizard-nav">
              <div class="wizard-steps px-8 py-8 px-lg-15 py-lg-3">
                <!--begin::Wizard Step 1 Nav-->
                <div class="wizard-step" data-wizard-type="step" data-wizard-state="current">
                  <div class="wizard-label">
                    <h3 class="wizard-title"><span>1.</span> {{ 'ReportSetup' | localize }}</h3>
                    <div class="wizard-bar"></div>
                  </div>
                </div>
                <!--end::Wizard Step 1 Nav-->

                <!--begin::Wizard Step 2 Nav-->
                <div class="wizard-step" data-wizard-type="step" data-wizard-state="pending">
                  <div class="wizard-label">
                    <h3 class="wizard-title"><span>2.</span> {{ 'SelectFilters' | localize }}</h3>
                    <div class="wizard-bar"></div>
                  </div>
                </div>
                <!--end::Wizard Step 2 Nav-->

                <!--begin::Wizard Step 3 Nav-->
                <div class="wizard-step" data-wizard-type="step" data-wizard-state="pending">
                  <div class="wizard-label">
                    <h3 class="wizard-title"><span>3.</span> {{ 'ReportDetails' | localize }}</h3>
                    <div class="wizard-bar"></div>
                  </div>
                </div>
                <!--end::Wizard Step 3 Nav-->

                <!--begin::Wizard Step 4 Nav-->
                <!--                <div class="wizard-step" data-wizard-type="step" data-wizard-state="pending">-->
                <!--                  <div class="wizard-label">-->
                <!--                    <h3 class="wizard-title"><span>4.</span> {{ 'AutomationSetup' }}</h3>-->
                <!--                    <div class="wizard-bar"></div>-->
                <!--                  </div>-->
                <!--                </div>-->
                <!--end::Wizard Step 4 Nav-->
              </div>
            </div>
            <!--end: Wizard Nav-->

            <!--begin: Wizard Body-->
            <div class="row justify-content-center py-10 px-8 py-lg-12 px-lg-10">
              <div class="col-xl-12" [ngClass]="{ 'col-xxl-7': activeStep !== 3, 'col-xxl-10': activeStep === 3 }">
                <!--begin: Wizard Form-->
                <form class="form fv-plugins-bootstrap fv-plugins-framework" id="kt_form" [formGroup]="step1Form">
                  <!--begin: Wizard Step 1-->
                  <div class="pb-5" data-wizard-type="step-content" data-wizard-state="current">
                    <h4 class="mb-10 font-weight-bold text-dark">{{ 'ReportSetup' | localize }}</h4>
                    <div class="d-flex">
                      <div class="form-group w-50">
                        <label>{{ 'ReportType' | localize }}</label>
                        <dx-select-box
                          id="type"
                          name="type"
                          formControlName="reportType"
                          displayExpr="displayName"
                          valueExpr="id"
                          [(value)]="reportDto.reportDefinitionId"
                          [dataSource]="reportDefinitions"
                          [searchEnabled]="true"
                          placeholder="{{ l('SelectType') }}"
                        >
                          <!--                                                    displayExpr="displayName"-->
                          <!--                                                    valueExpr="id"-->
                        </dx-select-box>
                        <span class="form-text text-muted">{{ 'PleaseSelectType' | localize }}</span>
                      </div>
                      <div class="form-group w-50 ml-4">
                        <label>{{ 'ReportName' | localize }}</label>
                        <dx-text-box
                          id="reportName"
                          formControlName="reportName"
                          name="reportName"
                          [(value)]="reportDto.displayName"
                          placeholder="{{ l('EnterReportName') }}"
                        >
                        </dx-text-box>
                        <span class="form-text text-muted">{{ 'PleaseEnterReportName' | localize }}</span>
                      </div>
                    </div>
                    <div class="d-flex">
                      <div class="form-group w-50">
                        <label>{{ 'SelectRole' | localize }}</label>
                        <dx-select-box
                          id="role"
                          name="role"
                          [(value)]="reportDto.grantedRoles"
                          [dataSource]="allRoles"
                          [searchEnabled]="true"
                          (onValueChanged)="selectedRoleChanged()"
                          displayExpr="displayName"
                          formControlName="grantedRoles"
                          valueExpr="id"
                          placeholder="{{ l('SelectRole') }}"
                        >
                        </dx-select-box>
                        <span class="form-text text-muted">{{ 'PleaseSelectType' | localize }}</span>
                      </div>
                      <div class="form-group w-50 ml-4">
                        <label>{{ 'ExcludingUsers' | localize }}</label>
                        <dx-select-box
                          id="excludingUsers"
                          name="excludingUsers"
                          displayExpr="displayName"
                          valueExpr="id"
                          formControlName="excludedUsers"
                          [(value)]="reportDto.excludedUsers"
                          [dataSource]="allUsers"
                          [searchEnabled]="true"
                          placeholder="{{ l('SelectExcludingUsers') }}"
                        >
                        </dx-select-box>
                        <span class="form-text text-muted">{{ 'PleaseSelectExcludingUsers' | localize }}</span>
                      </div>
                    </div>
                    <div class="d-flex">
                      <div class="form-group w-50">
                        <label>{{ 'ReportFormat' | localize }}</label>
                        <dx-select-box
                          id="format"
                          name="format"
                          displayExpr="value"
                          valueExpr="key"
                          formControlName="reportFormat"
                          [(value)]="reportDto.format"
                          [dataSource]="allFormats"
                          [searchEnabled]="true"
                          placeholder="{{ l('SelectFormat') }}"
                        >
                        </dx-select-box>
                        <span class="form-text text-muted">{{ 'PleaseSelectFormat' | localize }}</span>
                      </div>
                    </div>
                  </div>
                </form>
                <!--end: Wizard Step 1-->

                <form class="form fv-plugins-bootstrap fv-plugins-framework" id="kt_form_step2" [formGroup]="step2Form">
                  <!--begin: Wizard Step 2-->
                  <div class="pb-5" data-wizard-type="step-content">
                    <h4 class="mb-10 font-weight-bold text-dark">{{ 'SelectFilters' | localize }}</h4>
                    <div class="d-flex">
                      <dx-data-grid
                        #selectAttributesGrid
                        id="selectAttributesGrid"
                        [dataSource]="selectAttributesDataSource"
                        [remoteOperations]="false"
                        [showBorders]="true"
                        keyExpr="id"
                      >
                        <dxo-filter-row [visible]="false"></dxo-filter-row>
                        <dxo-editing mode="row" [allowUpdating]="false" [allowDeleting]="false" [allowAdding]="false"> </dxo-editing>
                        <dxi-column dataField="filterName" caption="{{ l('FilterName') }}"></dxi-column>
                        <dxi-column dataField="filterData" cellTemplate="filterDataTemplate" caption="{{ l('FilterData') }}"></dxi-column>
                        <div *dxTemplate="let cell of 'filterDataTemplate'">
                          <ng-container *ngIf="isArray(cell.data.filterSource)">
                            <dx-select-box
                              [id]="cell.data.filterName"
                              [name]="cell.data.filterName"
                              [(value)]="cell.data.filterData"
                              [dataSource]="cell.data.filterSource"
                              [searchEnabled]="true"
                              displayExpr="displayName"
                              valueExpr="id"
                              required
                              placeholder="{{ l('Select') }}"
                            >
                            </dx-select-box>
                          </ng-container>
                          <ng-container *ngIf="!isArray(cell.data.filterSource)">
                            <div class="d-flex" *ngIf="cell.data.filterSource === 'dateRange'">
                              <div class="w-50">
                                <dx-date-box
                                  [id]="cell.data.filterName + 'from'"
                                  [name]="cell.data.filterName + 'from'"
                                  [(value)]="cell.data.filterData.from"
                                  placeholder="{{ l('SelectDate') }}"
                                  displayFormat="dd/MM/yyyy"
                                  type="datetime"
                                >
                                </dx-date-box>
                              </div>
                              <div class="w-50 ml-4">
                                <dx-date-box
                                  [id]="cell.data.filterName + 'to'"
                                  [name]="cell.data.filterName + 'to'"
                                  [(value)]="cell.data.filterData.to"
                                  placeholder="{{ l('SelectDate') }}"
                                  displayFormat="dd/MM/yyyy"
                                  type="datetime"
                                >
                                </dx-date-box>
                              </div>
                            </div>
                            <div class="d-flex" *ngIf="cell.data.filterSource === 'date'">
                              <div class="w-100">
                                <dx-date-box
                                  [id]="cell.data.filterName + 'date'"
                                  [name]="cell.data.filterName + 'date'"
                                  [(value)]="cell.data.filterData"
                                  placeholder="{{ l('SelectDate') }}"
                                  displayFormat="dd/MM/yyyy"
                                  type="date"
                                >
                                </dx-date-box>
                              </div>
                            </div>
                            <div class="d-flex" *ngIf="cell.data.filterSource === 'dateTime'">
                              <div class="w-100">
                                <dx-date-box
                                  [id]="cell.data.filterName + 'date'"
                                  [name]="cell.data.filterName + 'date'"
                                  [(value)]="cell.data.filterData"
                                  placeholder="{{ l('Select') }}"
                                  displayFormat="dd/MM/yyyy"
                                  type="datetime"
                                >
                                </dx-date-box>
                              </div>
                            </div>
                          </ng-container>
                        </div>
                      </dx-data-grid>
                    </div>
                  </div>
                </form>
                <!--end: Wizard Step 2-->

                <!--begin: Wizard Step 3-->
                <form class="form fv-plugins-bootstrap fv-plugins-framework" id="kt_form_step3" [formGroup]="step3Form">
                  <div class="pb-5" data-wizard-type="step-content">
                    <h4 class="mb-10 font-weight-bold text-dark">{{ 'ReportDetails' | localize }}</h4>
                    <!-- TODO: ADD REPORT VIEWER HERE-->
                  </div>
                </form>
                <!--end: Wizard Step 3-->

                <!--begin: Wizard Step 4-->
                <!--                  <div class="pb-5" data-wizard-type="step-content">-->
                <!--                    &lt;!&ndash;  here will be the designer  &ndash;&gt;-->
                <!--                    <h4 class="mb-10 font-weight-bold text-dark">{{ 'AutomationSetup' | localize }}</h4>-->
                <!--                    <div class="d-flex">-->
                <!--                      <div class="form-group w-100">-->
                <!--                        <dx-check-box-->
                <!--                          [(value)]="step4Model.isGeneratedAutomatically"-->
                <!--                          text="{{ 'IsGeneratedAutomatically' | localize }}"-->
                <!--                          (onValueChanged)="openGeneratedAutomaticallyModal()"-->
                <!--                        ></dx-check-box>-->
                <!--                      </div>-->
                <!--                    </div>-->

                <!--                  </div>-->
                <!--end: Wizard Step 4-->

                <!--begin: Wizard Actions-->
                <div class="d-flex justify-content-between border-top mt-5 pt-10">
                  <div class="mr-2">
                    <button type="button" class="btn btn-light-primary font-weight-bolder text-uppercase px-9 py-4" data-wizard-type="action-prev">
                      Previous
                    </button>
                  </div>
                  <div>
                    <button type="button" class="btn btn-success font-weight-bolder text-uppercase px-9 py-4" data-wizard-type="action-submit">
                      Submit
                    </button>
                    <button type="button" class="btn btn-primary font-weight-bolder text-uppercase px-9 py-4" data-wizard-type="action-next">
                      Next
                    </button>
                  </div>
                </div>
                <!--end: Wizard Actions-->
                <div></div>
                <div></div>
                <div></div>
                <div></div>

                <!--end: Wizard Form-->
              </div>
            </div>
            <!--end: Wizard Body-->
          </div>
          <!--end: Wizard-->
        </div>
      </div>
    </div>
    <!--end::Container-->
  </div>
</div>
<app-automation-setup-modal #automationSetupModal (modalSave)="automationSetupModalSave($event)"></app-automation-setup-modal>
